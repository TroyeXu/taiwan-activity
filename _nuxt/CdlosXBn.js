import{r as v,j as i,cr as g,b9 as l}from"./CX06qJIc.js";const N=()=>{const r=v([]),a=v(new Set),s=v(!1),n=v(null),p=()=>{try{const e=localStorage.getItem("tourism-favorites");if(e){const o=JSON.parse(e);a.value=new Set(o)}}catch(e){console.warn("載入本地收藏失敗:",e)}},f=()=>{try{const e=r.value;console.log("準備儲存到 localStorage 的完整收藏資料:",e.length,"個"),localStorage.setItem("tourism-favorites-full",JSON.stringify(e));const o=Array.from(a.value);localStorage.setItem("tourism-favorites",JSON.stringify(o)),console.log("已儲存完整收藏資料到 localStorage")}catch(e){console.warn("儲存本地收藏失敗:",e)}},h=async()=>{s.value=!0,n.value=null;try{console.log("開始載入收藏（純 localStorage 模式）...");try{const e=localStorage.getItem("tourism-favorites-full");if(e){const o=JSON.parse(e);r.value=o,a.value=new Set(o.map(t=>t.activityId)),console.log(`成功載入 ${o.length} 個收藏活動`)}else r.value=[],a.value=new Set,console.log("沒有收藏的活動")}catch(e){console.warn("載入本地收藏失敗:",e),r.value=[],a.value=new Set}}catch(e){const o=e instanceof Error?e.message:"載入收藏失敗";n.value=o,console.error("載入收藏失敗:",e),l.error(o)}finally{s.value=!1}},d=async e=>{if(console.log("準備加入收藏:",e.name,e.id),a.value.has(e.id)){console.log("活動已在收藏中:",e.id),l.info("此活動已在收藏中");return}s.value=!0,n.value=null;try{console.log("開始加入收藏流程..."),a.value.add(e.id),console.log("已加入到 favoriteIds:",Array.from(a.value));const o=r.value.findIndex(t=>t.activityId===e.id);if(console.log("檢查是否已存在於 favorites 列表中:",o),o===-1){const t={id:`fav_${e.id}_${Date.now()}`,activityId:e.id,userId:null,activity:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};r.value.push(t),console.log("已加入到 favorites 列表，目前總數:",r.value.length)}f(),console.log("已儲存到 localStorage"),l.success("已加入收藏")}catch(o){const t=o instanceof Error?o.message:"加入收藏失敗";n.value=t,l.error(t),console.error("加入收藏失敗:",o)}finally{s.value=!1}},m=async e=>{if(console.log("準備移除收藏:",e),!a.value.has(e)){console.log("活動不在收藏中:",e);return}s.value=!0,n.value=null;try{a.value.delete(e),r.value=r.value.filter(o=>o.activityId!==e),console.log("已移除收藏，剩餘收藏數量:",r.value.length),f(),l.success("已從收藏移除")}catch(o){const t=o instanceof Error?o.message:"移除收藏失敗";n.value=t,l.error(t),console.error("移除收藏失敗:",o)}finally{s.value=!1}},w=async e=>{S(e.id)?await m(e.id):await d(e)},S=e=>a.value.has(e),F=async()=>{s.value=!0,n.value=null;try{console.log("準備清空所有收藏"),a.value.clear(),r.value=[],f(),console.log("已清空所有收藏"),l.success("已清空所有收藏")}catch(e){const o=e instanceof Error?e.message:"清空收藏失敗";n.value=o,l.error(o),console.error("清空收藏失敗:",e)}finally{s.value=!1}},I=()=>{try{const e={exportDate:new Date().toISOString(),favorites:r.value.map(c=>({id:c.activity.id,name:c.activity.name,description:c.activity.description,location:c.activity.location,time:c.activity.time,categories:c.activity.categories}))},o=JSON.stringify(e,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(o),A=`我的收藏_${new Date().toLocaleDateString("zh-TW")}.json`,y=document.createElement("a");y.setAttribute("href",t),y.setAttribute("download",A),y.click(),l.success("收藏列表已匯出")}catch(e){l.error("匯出失敗"),console.error("匯出收藏失敗:",e)}},E=i(()=>{const e={};return r.value.forEach(o=>{o.activity.categories?.forEach(t=>{e[t.name]=(e[t.name]||0)+1})}),Object.entries(e).map(([o,t])=>({name:o,count:t})).sort((o,t)=>t.count-o.count)}),D=i(()=>{const e={};return r.value.forEach(o=>{const t=o.activity.location?.region;t&&(e[t]=(e[t]||0)+1)}),Object.entries(e).map(([o,t])=>({region:o,count:t})).sort((o,t)=>t.count-o.count)}),u=i(()=>r.value.length),O=i(()=>u.value>0),x=i(()=>!s.value&&u.value===0);return p(),{favorites:g(r),favoriteIds:g(a),loading:g(s),error:g(n),favoritesCount:u,favoriteCount:u,hasFavorites:O,isEmpty:x,getFavoritesByCategory:E,getFavoritesByRegion:D,loadFavorites:h,refreshFavorites:h,addToFavorites:d,addFavorite:d,removeFromFavorites:m,removeFavorite:m,toggleFavorite:w,isFavorite:S,isFavorited:S,clearAllFavorites:F,clearFavorites:F,exportFavorites:I}};export{N as u};
