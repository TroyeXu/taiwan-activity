import{f as ie,V as H,_ as re,o as q,p as ce,j as S,av as ue,d as de,q as p,t as u,ar as k,v as c,A as w,y as n,D as I,E as y,F as v,H as me,T as pe,br as fe,r as F,M as ve,Q as ye,a7 as t,a0 as s,$ as U,aN as _e,a9 as ge,b1 as be,ay as $,az as A,bf as Ee,B as T,bg as xe,b7 as we,am as Se,z as ke,bE as Ce,b9 as j,b4 as he}from"./CX06qJIc.js";import{b as De,E as Fe,a as Ve,e as $e}from"./BRyJBjxv.js";import{E as Ae,a as Te,b as je}from"./E116K6L7.js";import{E as Ne,a as Be}from"./D-0JLmHF.js";import"./B4G3hqkR.js";import{u as ze}from"./CdlosXBn.js";const Oe=ie({decimalSeparator:{type:String,default:"."},groupSeparator:{type:String,default:","},precision:{type:Number,default:0},formatter:Function,value:{type:H([Number,Object]),default:0},prefix:String,suffix:String,title:String,valueStyle:{type:H([String,Object,Array])}}),Re=q({name:"ElStatistic"}),Ie=q({...Re,props:Oe,setup(L,{expose:C}){const _=L,f=ce("statistic"),g=S(()=>{const{value:o,formatter:m,precision:h,decimalSeparator:N,groupSeparator:B}=_;if(ue(m))return m(o);if(!de(o)||Number.isNaN(o))return o;let[D,E=""]=String(o).split(".");return E=E.padEnd(h,"0").slice(0,h>0?h:0),D=D.replace(/\B(?=(\d{3})+(?!\d))/g,B),[D,E].join(E?N:"")});return C({displayValue:g}),(o,m)=>(u(),p("div",{class:w(n(f).b())},[o.$slots.title||o.title?(u(),p("div",{key:0,class:w(n(f).e("head"))},[I(o.$slots,"title",{},()=>[y(v(o.title),1)])],2)):k("v-if",!0),c("div",{class:w(n(f).e("content"))},[o.$slots.prefix||o.prefix?(u(),p("div",{key:0,class:w(n(f).e("prefix"))},[I(o.$slots,"prefix",{},()=>[c("span",null,v(o.prefix),1)])],2)):k("v-if",!0),c("span",{class:w(n(f).e("number")),style:me(o.valueStyle)},v(n(g)),7),o.$slots.suffix||o.suffix?(u(),p("div",{key:1,class:w(n(f).e("suffix"))},[I(o.$slots,"suffix",{},()=>[c("span",null,v(o.suffix),1)])],2)):k("v-if",!0)],2)],2))}});var Ue=re(Ie,[["__file","statistic.vue"]]);const qe=pe(Ue),Le={class:"min-h-screen bg-gray-50"},Me={class:"flex items-center gap-3"},Pe={key:0,class:"space-y-4"},He={key:1,class:"text-center py-16"},We={key:2},Qe={class:"text-lg font-bold"},Ge={class:"text-lg font-bold"},Je={class:"space-y-2"},Ke=["onClick"],Xe={class:"flex-1"},Ye={class:"font-semibold text-lg text-gray-900 mb-1"},Ze={class:"flex items-center text-sm text-gray-500 space-x-4"},et={key:0},tt={key:1},at={class:"text-xs"},st=q({__name:"favorites",setup(L){fe({title:"我的收藏 - 台灣觀光活動地圖",meta:[{name:"description",content:"查看您收藏的所有精彩觀光活動"}]});const C=F(!1),_=F(!1),f=F(""),g=F(""),o=F("favorited_desc"),{favorites:m,loading:h,removeFavorite:N,clearFavorites:B,refreshFavorites:D}=ze(),E=S(()=>{const a=new Set;return m.value.forEach(e=>{e.activity.categories?.forEach(i=>a.add(i.name))}),Array.from(a).sort()}),W=S(()=>{const a=new Set;return m.value.forEach(e=>{e.activity.location?.region&&a.add(e.activity.location.region)}),Array.from(a).sort()}),Q=S(()=>{if(m.value.length===0)return"";const a=m.value.reduce((e,i)=>new Date(i.createdAt)>new Date(e.createdAt)?i:e);return V(a.createdAt)}),G=S(()=>{const a=new Map;m.value.forEach(d=>{d.activity.categories?.forEach(r=>{a.set(r.name,(a.get(r.name)||0)+1)})});let e="",i=0;for(const[d,r]of a)r>i&&(i=r,e=d);return e||"無"}),J=S(()=>{let a=[...m.value];return f.value&&(a=a.filter(e=>e.activity.categories?.some(i=>i.name===f.value))),g.value&&(a=a.filter(e=>e.activity.location?.region===g.value)),a.sort((e,i)=>{switch(o.value){case"favorited_desc":return new Date(i.createdAt).getTime()-new Date(e.createdAt).getTime();case"favorited_asc":return new Date(e.createdAt).getTime()-new Date(i.createdAt).getTime();case"activity_date":{const d=e.activity.time?.startDate||"",r=i.activity.time?.startDate||"";return new Date(d).getTime()-new Date(r).getTime()}case"name":return e.activity.name.localeCompare(i.activity.name,"zh-TW");case"quality":return(i.activity.qualityScore||0)-(e.activity.qualityScore||0);default:return 0}}),a});ve(()=>{D()});const V=a=>new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}),M=()=>{},K=()=>{},X=a=>{Ce(`/activity/${a.activity.id}`)},Y=async a=>{try{await N(a),j.success("已移除收藏")}catch{j.error("移除收藏失敗")}},Z=async()=>{try{await B(),_.value=!1,j.success("已清空所有收藏")}catch{j.error("清空收藏失敗")}},ee=()=>{const a=m.value.map(r=>({活動名稱:r.activity.name,活動摘要:r.activity.summary,地址:r.activity.location?.address,城市:r.activity.location?.city,地區:r.activity.location?.region,活動時間:r.activity.time?.startDate,分類:r.activity.categories?.map(z=>z.name).join(", "),收藏時間:V(r.createdAt)})),e=a.length>0?[Object.keys(a[0]).join(","),...a.map(r=>Object.values(r).join(","))].join(`
`):"",i=new Blob(["\uFEFF"+e],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(i),d.download=`收藏活動_${new Date().toISOString().split("T")[0]}.csv`,d.click()};return ye(C,a=>{C.value=a||h.value}),(a,e)=>{const i=ge,d=_e,r=De,z=Ae,te=Ve,O=Fe,ae=Ne,se=qe,x=je,P=Te,b=xe,R=Ee,le=$e,oe=Be;return u(),p("div",Le,[t(z,{onBack:e[1]||(e[1]=()=>a.$router.push("/")),class:"bg-white shadow-sm"},{title:s(()=>[c("div",Me,[t(i,null,{default:s(()=>[t(n(be))]),_:1}),e[8]||(e[8]=c("h1",{class:"text-xl font-semibold text-gray-800"},"我的收藏",-1))])]),extra:s(()=>[t(r,null,{default:s(()=>[n(m).length>0?(u(),U(d,{key:0,onClick:e[0]||(e[0]=l=>_.value=!0),type:"danger",plain:""},{default:s(()=>e[9]||(e[9]=[y(" 清空收藏 ",-1)])),_:1,__:[9]})):k("",!0),t(d,{onClick:ee,disabled:n(m).length===0},{default:s(()=>e[10]||(e[10]=[y(" 匯出收藏 ",-1)])),_:1,__:[10]},8,["disabled"])]),_:1})]),_:1}),t(le,{class:"max-w-6xl mx-auto p-6"},{default:s(()=>[n(C)?(u(),p("div",Pe,[(u(),p($,null,A(6,l=>t(O,{key:l},{default:s(()=>[t(te,{rows:3,animated:""})]),_:2},1024)),64))])):n(m).length===0?(u(),p("div",He,[t(ae,{description:"還沒有收藏任何活動","image-size":200},{description:s(()=>e[11]||(e[11]=[c("p",{class:"text-gray-500 mb-4"},"探索更多精彩活動，將喜歡的活動加入收藏吧！",-1)])),default:s(()=>[t(d,{type:"primary",onClick:e[2]||(e[2]=l=>a.$router.push("/"))},{default:s(()=>e[12]||(e[12]=[y(" 探索活動 ",-1)])),_:1,__:[12]})]),_:1})])):(u(),p("div",We,[t(O,{class:"mb-6"},{default:s(()=>[t(P,{gutter:24},{default:s(()=>[t(x,{span:8},{default:s(()=>[t(se,{title:"收藏總數",value:n(m).length,suffix:"個活動"},null,8,["value"])]),_:1}),t(x,{span:8},{default:s(()=>[c("div",null,[e[13]||(e[13]=c("p",{class:"text-sm text-gray-500 mb-1"},"最近收藏",-1)),c("p",Qe,v(n(Q)),1)])]),_:1}),t(x,{span:8},{default:s(()=>[c("div",null,[e[14]||(e[14]=c("p",{class:"text-sm text-gray-500 mb-1"},"最愛分類",-1)),c("p",Ge,v(n(G)||"無"),1)])]),_:1})]),_:1})]),_:1}),t(O,{class:"mb-6"},{default:s(()=>[t(P,{gutter:16,align:"middle"},{default:s(()=>[t(x,{span:6},{default:s(()=>[t(R,{modelValue:n(f),"onUpdate:modelValue":e[3]||(e[3]=l=>T(f)?f.value=l:null),placeholder:"篩選分類",clearable:"",onChange:M},{default:s(()=>[(u(!0),p($,null,A(n(E),l=>(u(),U(b,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{span:6},{default:s(()=>[t(R,{modelValue:n(g),"onUpdate:modelValue":e[4]||(e[4]=l=>T(g)?g.value=l:null),placeholder:"篩選地區",clearable:"",onChange:M},{default:s(()=>[(u(!0),p($,null,A(n(W),l=>(u(),U(b,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{span:6},{default:s(()=>[t(R,{modelValue:n(o),"onUpdate:modelValue":e[5]||(e[5]=l=>T(o)?o.value=l:null),placeholder:"排序方式",onChange:K},{default:s(()=>[t(b,{label:"收藏時間 (新到舊)",value:"favorited_desc"}),t(b,{label:"收藏時間 (舊到新)",value:"favorited_asc"}),t(b,{label:"活動時間",value:"activity_date"}),t(b,{label:"活動名稱",value:"name"}),t(b,{label:"品質分數",value:"quality"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),c("div",Je,[(u(!0),p($,null,A(n(J),l=>(u(),p("div",{key:l.id,class:"flex items-center justify-between p-4 bg-white rounded-lg border hover:shadow-md transition-shadow cursor-pointer",onClick:ne=>X(l)},[c("div",Xe,[c("h3",Ye,v(l.activity.name),1),c("div",Ze,[l.activity.location?(u(),p("span",et,[t(i,{class:"mr-1"},{default:s(()=>[t(n(we))]),_:1}),y(" "+v(l.activity.location.city),1)])):k("",!0),l.activity.time?(u(),p("span",tt,[t(i,{class:"mr-1"},{default:s(()=>[t(n(Se))]),_:1}),y(" "+v(V(l.activity.time.startDate)),1)])):k("",!0),c("span",at," 收藏於 "+v(V(l.createdAt)),1)])]),t(d,{type:"danger",size:"small",plain:"",onClick:ke(ne=>Y(l.activityId),["stop"])},{default:s(()=>e[15]||(e[15]=[y(" 移除 ",-1)])),_:2,__:[15]},1032,["onClick"])],8,Ke))),128))])]))]),_:1}),t(oe,{modelValue:n(_),"onUpdate:modelValue":e[7]||(e[7]=l=>T(_)?_.value=l:null),title:"確認清空收藏",width:"400px","align-center":""},{footer:s(()=>[t(d,{onClick:e[6]||(e[6]=l=>_.value=!1)},{default:s(()=>e[16]||(e[16]=[y("取消",-1)])),_:1,__:[16]}),t(d,{type:"danger",onClick:Z},{default:s(()=>e[17]||(e[17]=[y("確認清空",-1)])),_:1,__:[17]})]),default:s(()=>[e[18]||(e[18]=c("p",null,"確定要清空所有收藏的活動嗎？此操作無法復原。",-1))]),_:1,__:[18]},8,["modelValue"])])}}}),ut=he(st,[["__scopeId","data-v-866a6c7e"]]);export{ut as default};
