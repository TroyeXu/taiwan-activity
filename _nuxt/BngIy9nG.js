import{f as H,_ as V,o as G,aG as W,n as _,j as w,r as u,p as J,ai as Z,aZ as K,$ as Q,t as g,a0 as P,a7 as A,a3 as X,y as a,w as Y,bI as x,v as j,a1 as ee,z as ae,q as I,ar as y,A as h,D as $,F as te,a9 as oe,bb as se,ab as re,bJ as le,T as ne,M as ie,cr as b}from"./CX06qJIc.js";import{c as ce,e as ue,u as de,E as fe}from"./B4G3hqkR.js";const pe=H({...ue,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),ve=ce,he=G({name:"ElDrawer",inheritAttrs:!1}),me=G({...he,props:pe,emits:ve,setup(D,{expose:L}){const d=D,R=W();_({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},w(()=>!!R.title));const l=u(),f=u(),r=J("drawer"),{t:n}=Z(),{afterEnter:c,afterLeave:i,beforeLeave:p,visible:v,rendered:k,titleId:C,bodyId:S,zIndex:T,onModalClick:z,onOpenAutoFocus:B,onCloseAutoFocus:q,onFocusoutPrevented:N,onCloseRequested:O,handleClose:E}=de(d,l),U=w(()=>d.direction==="rtl"||d.direction==="ltr"),F=w(()=>K(d.size));return L({handleClose:E,afterEnter:c,afterLeave:i}),(e,t)=>(g(),Q(a(le),{to:e.appendTo,disabled:e.appendTo!=="body"?!1:!e.appendToBody},{default:P(()=>[A(X,{name:a(r).b("fade"),onAfterEnter:a(c),onAfterLeave:a(i),onBeforeLeave:a(p),persisted:""},{default:P(()=>[Y(A(a(fe),{mask:e.modal,"overlay-class":e.modalClass,"z-index":a(T),onClick:a(z)},{default:P(()=>[A(a(x),{loop:"",trapped:a(v),"focus-trap-el":l.value,"focus-start-el":f.value,onFocusAfterTrapped:a(B),onFocusAfterReleased:a(q),onFocusoutPrevented:a(N),onReleaseRequested:a(O)},{default:P(()=>[j("div",ee({ref_key:"drawerRef",ref:l,"aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:a(C),"aria-describedby":a(S)},e.$attrs,{class:[a(r).b(),e.direction,a(v)&&"open"],style:a(U)?"width: "+a(F):"height: "+a(F),role:"dialog",onClick:ae(()=>{},["stop"])}),[j("span",{ref_key:"focusStartRef",ref:f,class:h(a(r).e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(g(),I("header",{key:0,class:h([a(r).e("header"),e.headerClass])},[e.$slots.title?$(e.$slots,"title",{key:1},()=>[y(" DEPRECATED SLOT ")]):$(e.$slots,"header",{key:0,close:a(E),titleId:a(C),titleClass:a(r).e("title")},()=>[e.$slots.title?y("v-if",!0):(g(),I("span",{key:0,id:a(C),role:"heading","aria-level":e.headerAriaLevel,class:h(a(r).e("title"))},te(e.title),11,["id","aria-level"]))]),e.showClose?(g(),I("button",{key:2,"aria-label":a(n)("el.drawer.close"),class:h(a(r).e("close-btn")),type:"button",onClick:a(E)},[A(a(oe),{class:h(a(r).e("close"))},{default:P(()=>[A(a(se))]),_:1},8,["class"])],10,["aria-label","onClick"])):y("v-if",!0)],2)):y("v-if",!0),a(k)?(g(),I("div",{key:1,id:a(S),class:h([a(r).e("body"),e.bodyClass])},[$(e.$slots,"default")],10,["id"])):y("v-if",!0),e.$slots.footer?(g(),I("div",{key:2,class:h([a(r).e("footer"),e.footerClass])},[$(e.$slots,"footer")],2)):y("v-if",!0)],16,["aria-label","aria-labelledby","aria-describedby","onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[re,a(v)]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var ge=V(me,[["__file","drawer.vue"]]);const ke=ne(ge),Ce=(D={})=>{const{enableHighAccuracy:L=!0,timeout:d=1e4,maximumAge:R=3e5}=D,l=u(null),f=u(null),r=u(!1),n=u(null),c=u(!1),i=u(null),p=()=>(c.value="geolocation"in navigator,c.value),v=async()=>{if(!p())return null;try{if("permissions"in navigator){const e=await navigator.permissions.query({name:"geolocation"});return i.value=e.state,e.onchange=()=>{i.value=e.state},e.state}}catch(e){console.warn("無法檢查地理位置權限:",e)}return null},k=async()=>{if(!p())return n.value="瀏覽器不支援地理位置功能",null;r.value=!0,n.value=null;try{const e=await new Promise((o,s)=>{navigator.geolocation.getCurrentPosition(o,s,{enableHighAccuracy:L,timeout:d,maximumAge:R})}),t={lat:e.coords.latitude,lng:e.coords.longitude};return l.value=t,await T(t),console.log("成功取得位置:",t),t}catch(e){let t="無法取得位置資訊";if(e instanceof GeolocationPositionError||e.code!==void 0)switch(e.code){case 1:t="無法取得位置，請檢查瀏覽器權限設定",console.error("定位權限被拒絕，請在瀏覽器設定中允許此網站存取您的位置");break;case 2:t="無法取得位置資訊",console.error("無法取得位置資訊，請確認您的裝置已開啟定位功能");break;case 3:t="取得位置資訊超時",console.error("取得位置超時，請稍後再試");break}return n.value=t,console.error("定位錯誤:",e),null}finally{r.value=!1}},C=(e,t)=>p()?navigator.geolocation.watchPosition(o=>{const s={lat:o.coords.latitude,lng:o.coords.longitude};l.value=s,e(s)},o=>{let s="無法監聽位置變化";if(o instanceof GeolocationPositionError)switch(o.code){case o.PERMISSION_DENIED:s="使用者拒絕了地理位置請求";break;case o.POSITION_UNAVAILABLE:s="無法取得位置資訊";break;case o.TIMEOUT:s="取得位置資訊超時";break}n.value=s,t?.(s)},{enableHighAccuracy:L,timeout:d,maximumAge:R}):(t?.("瀏覽器不支援地理位置功能"),null),S=e=>{c.value&&e&&navigator.geolocation.clearWatch(e)},T=async e=>{try{const o=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e.lat}&lon=${e.lng}&accept-language=zh-TW,zh,en`)).json();return o&&o.display_name?(f.value=o.display_name,o.display_name):(console.warn("反向地理編碼失敗: 無資料"),null)}catch(t){return console.error("反向地理編碼錯誤:",t),null}},z=async e=>{try{const t=encodeURIComponent(e),s=await(await fetch(`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${t}&countrycodes=tw&accept-language=zh-TW,zh,en&limit=1`)).json();if(s&&s.length>0){const m=s[0],M={lat:parseFloat(m.lat),lng:parseFloat(m.lon)};return l.value=M,f.value=m.display_name,M}else return console.warn("地理編碼失敗: 找不到地址"),null}catch(t){return console.error("地理編碼錯誤:",t),null}},B=(e,t)=>{const s=(t.lat-e.lat)*(Math.PI/180),m=(t.lng-e.lng)*(Math.PI/180),M=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.lat*(Math.PI/180))*Math.cos(t.lat*(Math.PI/180))*Math.sin(m/2)*Math.sin(m/2);return 6371*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))},q=e=>e<1?`${Math.round(e*1e3)}m`:e<10?`${e.toFixed(1)}km`:`${Math.round(e)}km`,N=async()=>{try{return await v(),i.value==="granted"?!0:i.value==="denied"?(n.value="地理位置權限已被拒絕，請在瀏覽器設定中手動開啟",!1):await k()!==null}catch{return!1}},O=()=>{l.value=null,f.value=null,n.value=null,r.value=!1},E=w(()=>l.value!==null),U=w(()=>n.value!==null),F=w(()=>c.value&&i.value!=="denied");return ie(()=>{p(),v()}),{coordinates:b(l),address:b(f),loading:b(r),error:b(n),supported:b(c),permission:b(i),hasLocation:E,hasError:U,canUseLocation:F,checkSupport:p,checkPermission:v,getCurrentPosition:k,getUserLocation:k,watchPosition:C,clearWatch:S,reverseGeocode:T,geocodeAddress:z,calculateDistance:B,formatDistance:q,requestPermission:N,reset:O}};export{ke as E,Ce as u};
