const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CX06qJIc.js","./entry.E8WsKDkp.css"])))=>i.map(i=>d[i]);
import{by as S,o as $,r as f,bz as L,j,M as C,q as w,t as y,v as n,F as h,y as c,ar as E,bA as D}from"./CX06qJIc.js";let _=null,r=null,p=!1;const R=()=>{const q=async()=>_||(console.log("ğŸš€ åˆå§‹åŒ– SQL.js..."),_=await(await S(()=>import("./CX06qJIc.js").then(l=>l.s),__vite__mapDeps([0,1]),import.meta.url)).default({locateFile:l=>l==="sql-wasm.wasm"?"https://sql.js.org/dist/sql-wasm.wasm":`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${l}`}),console.log("âœ… SQL.js åˆå§‹åŒ–æˆåŠŸ"),_),d=async()=>{console.log("ğŸ“‚ é–‹å§‹è¼‰å…¥è³‡æ–™åº«æª”æ¡ˆ...");const s=window.location.hostname,l=window.location.pathname,e=window.location.origin;console.log("ğŸ“ ç•¶å‰ç’°å¢ƒ:",{hostname:s,pathname:l,origin:e});const a=[];if(s.includes("github.io")){const o=l.split("/").filter(Boolean)[0]||"taiwan-activity";a.push(`${e}/${o}/tourism.sqlite`,"https://troyexu.github.io/taiwan-activity/tourism.sqlite")}(s==="localhost"||s==="127.0.0.1")&&a.push("/tourism.sqlite",`${e}/tourism.sqlite`),a.push("https://cdn.jsdelivr.net/gh/TroyeXu/taiwan-activity@main/public/tourism.sqlite","https://raw.githubusercontent.com/TroyeXu/taiwan-activity/main/public/tourism.sqlite"),console.log("ğŸ” å˜—è©¦è¼‰å…¥çš„ URL:",a);for(const i of a)try{console.log(`ğŸ“¥ å˜—è©¦: ${i}`);const o=await fetch(i,{method:"GET",cache:"default",mode:"cors"});if(!o.ok){console.log(`âŒ å›æ‡‰éŒ¯èª¤ (${o.status}): ${i}`);continue}const t=await o.arrayBuffer();if(t.byteLength<100){console.log(`âŒ æª”æ¡ˆå¤ªå°ï¼Œå¯èƒ½ç„¡æ•ˆ: ${i}`);continue}const g=new Uint8Array(t,0,16);if(Array.from(g).map(x=>String.fromCharCode(x)).join("").startsWith("SQLite format 3"))return console.log(`âœ… æˆåŠŸè¼‰å…¥è³‡æ–™åº« (${(t.byteLength/1024/1024).toFixed(2)} MB): ${i}`),t;console.log(`âŒ é SQLite æª”æ¡ˆ: ${i}`)}catch(o){console.error(`âŒ è¼‰å…¥å¤±æ•—: ${i}`,o)}throw new Error("ç„¡æ³•è¼‰å…¥è³‡æ–™åº«æª”æ¡ˆï¼šæ‰€æœ‰å˜—è©¦éƒ½å¤±æ•—")},u=async()=>{if(r)return r;if(p){for(;p;)await new Promise(s=>setTimeout(s,100));if(r)return r}p=!0;try{const s=await q(),l=await d();r=new s.Database(new Uint8Array(l));const e=r.exec("SELECT COUNT(*) as count FROM sqlite_master");return console.log("âœ… è³‡æ–™åº«åˆå§‹åŒ–æˆåŠŸï¼Œè¡¨æ ¼æ•¸é‡:",e[0]?.values[0][0]),r}catch(s){throw console.error("âŒ è³‡æ–™åº«åˆå§‹åŒ–å¤±æ•—:",s),s}finally{p=!1}};return{initDatabase:u,query:async(s,l=[])=>{const e=await u();try{const a=e.prepare(s);a.bind(l);const i=[];for(;a.step();)i.push(a.getAsObject());return a.free(),i}catch(a){throw console.error("æŸ¥è©¢éŒ¯èª¤:",{sql:s,params:l,error:a}),a}},resetDatabase:()=>{r&&(r.close(),r=null),p=!1,console.log("ğŸ”„ è³‡æ–™åº«å·²é‡ç½®")},loadDatabaseFile:d}},T={class:"container mx-auto p-4"},k={class:"space-y-4"},O={class:"bg-gray-100 p-4 rounded"},M={class:"text-sm"},U={class:"bg-blue-100 p-4 rounded"},A={key:0},F={key:1,class:"text-red-600"},N={class:"text-xs mt-2"},B={key:2,class:"text-green-600"},Q={class:"space-x-2"},I=["disabled"],J={class:"bg-gray-100 p-4 rounded"},W={class:"text-xs overflow-auto max-h-96"},V=$({__name:"db-test",setup(q){const d=f(!1),u=f(null),m=f(null),b=f([]),{$config:s}=L(),l=j(()=>JSON.stringify({baseURL:s.app.baseURL,env:"production",url:window.location.href,origin:window.location.origin,pathname:window.location.pathname},null,2)),e=o=>{const t=new Date().toISOString();b.value.push(`[${t}] ${o}`),console.log(o)},a=async()=>{d.value=!0,u.value=null,m.value=null,b.value=[];try{e("é–‹å§‹æ¸¬è©¦è³‡æ–™åº«è¼‰å…¥..."),e(`ç’°å¢ƒ: ${window.location.href}`),e("ä½¿ç”¨ useSqliteWeb è¼‰å…¥è³‡æ–™åº«...");const{initDatabase:o,query:t}=R();e("åˆå§‹åŒ–è³‡æ–™åº«..."),await o(),e("è³‡æ–™åº«åˆå§‹åŒ–æˆåŠŸ"),e("åŸ·è¡Œæ¸¬è©¦æŸ¥è©¢...");const g=await t("SELECT COUNT(*) as count FROM activities");e(`æŸ¥è©¢æˆåŠŸï¼Œæ´»å‹•æ•¸é‡: ${g[0].count}`);const v=await t("SELECT name FROM sqlite_master WHERE type='table'");e(`è³‡æ–™è¡¨æ•¸é‡: ${v.length}`),e(`è³‡æ–™è¡¨åç¨±: ${v.map(x=>x.name).join(", ")}`),m.value=g[0]}catch(o){u.value=o,e(`éŒ¯èª¤: ${o}`),console.error("è©³ç´°éŒ¯èª¤:",o)}finally{d.value=!1}},i=()=>{D.clearCache(),e("å¿«å–å·²æ¸…é™¤")};return C(()=>{a()}),(o,t)=>(y(),w("div",T,[t[4]||(t[4]=n("h1",{class:"text-2xl font-bold mb-4"},"è³‡æ–™åº«è¼‰å…¥æ¸¬è©¦",-1)),n("div",k,[n("div",O,[t[0]||(t[0]=n("h2",{class:"text-lg font-semibold mb-2"},"ç’°å¢ƒè³‡è¨Š",-1)),n("pre",M,h(c(l)),1)]),n("div",U,[t[2]||(t[2]=n("h2",{class:"text-lg font-semibold mb-2"},"è³‡æ–™åº«è¼‰å…¥ç‹€æ…‹",-1)),c(d)?(y(),w("div",A,"è¼‰å…¥ä¸­...")):c(u)?(y(),w("div",F,[n("p",null,"éŒ¯èª¤: "+h(c(u).message),1),n("pre",N,h(c(u).stack),1)])):c(m)?(y(),w("div",B,[t[1]||(t[1]=n("p",null,"âœ… è¼‰å…¥æˆåŠŸï¼",-1)),n("p",null,"æ¸¬è©¦æŸ¥è©¢çµæœ: "+h(c(m)),1)])):E("",!0)]),n("div",Q,[n("button",{onClick:a,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:c(d)}," æ¸¬è©¦è³‡æ–™åº«è¼‰å…¥ ",8,I),n("button",{onClick:i,class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"}," æ¸…é™¤å¿«å– ")]),n("div",J,[t[3]||(t[3]=n("h2",{class:"text-lg font-semibold mb-2"},"è©³ç´°æ—¥èªŒ",-1)),n("pre",W,h(c(b).join(`
`)),1)])])]))}});export{V as default};
