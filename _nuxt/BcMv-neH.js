import{a as Q,E as U,b as X,e as Z}from"./BRyJBjxv.js";import{o as tt,bq as et,bm as st,r as E,M as at,br as it,j as q,bK as lt,q as u,t as n,ar as c,y as e,a7 as o,a0 as l,aN as ot,E as m,a9 as nt,bp as rt,v as i,$ as f,F as d,b2 as dt,bL as ut,ay as x,az as h,a8 as N,b7 as ct,A as mt,bM as ft,bN as _t,am as T,al as vt,b9 as pt,b4 as gt}from"./CX06qJIc.js";import{b as yt,F as xt,E as ht,a as bt,A as kt}from"./ByqzxWCs.js";import{E as Et,a as Ct,b as At}from"./E116K6L7.js";import"./CdlosXBn.js";const Rt={class:"min-h-screen bg-gray-50"},Dt={key:0,class:"flex items-center justify-center min-h-screen"},$t={key:1,class:"flex items-center justify-center min-h-screen"},St={key:2},zt={class:"flex items-center gap-2"},It=["src","alt"],qt={key:0,class:"mb-4 p-4 bg-blue-50 rounded-lg"},Nt={class:"text-blue-700"},Tt={key:1,class:"prose max-w-none"},Bt={class:"whitespace-pre-wrap"},Ft={key:2,class:"mt-4"},Lt={class:"text-lg font-semibold flex items-center gap-2"},Mt={class:"space-y-4"},jt={class:"text-gray-700"},Yt={class:"text-sm text-gray-500"},Ht={key:0},Vt={class:"text-gray-700"},Ot={key:1},Jt={class:"h-64 bg-gray-100 rounded-lg"},Kt={class:"text-lg font-semibold flex items-center gap-2"},Pt={class:"space-y-4"},Wt={key:0},wt={class:"text-gray-700"},Gt={class:"text-xs text-gray-500"},Qt={key:1},Ut={class:"flex items-center gap-2 mb-2"},Xt={class:"text-xs text-gray-500 mb-2"},Zt={key:0},te={class:"text-sm text-gray-600 space-y-1"},ee={class:"text-lg font-semibold flex items-center gap-2"},se={class:"space-y-4"},ae={class:"flex items-center gap-2 text-gray-700"},ie={key:0},le={class:"flex items-center gap-2 text-gray-700"},oe={key:1},ne={key:2,class:"text-xs text-gray-500"},re={class:"space-y-3"},de=["onClick"],ue={class:"font-medium text-sm mb-1"},ce={class:"text-xs text-gray-600 mb-2"},me={class:"flex justify-between items-center text-xs text-gray-500"},fe={key:0},_e=tt({__name:"[id]",setup(ve){const D=et().params.id,{getActivity:B,getNearbyActivities:F,initDatabase:L}=st(),t=E(null),b=E([]),C=E(!0),v=E(null),$=s=>({id:s.id,name:s.name,description:s.description||void 0,summary:s.summary||void 0,status:s.status||"active",qualityScore:s.qualityScore||0,createdAt:s.createdAt,updatedAt:s.updatedAt,location:s.latitude&&s.longitude?{id:s.locationId||"",activityId:s.id,address:s.address,district:s.district||void 0,city:s.city,region:s.region||"north",latitude:s.latitude,longitude:s.longitude,venue:s.venue||void 0,landmarks:s.landmarks?JSON.parse(s.landmarks):[]}:void 0,time:s.startDate?{id:s.timeId||"",activityId:s.id,startDate:s.startDate,endDate:s.endDate,startTime:s.startTime,endTime:s.endTime,timezone:s.timezone||"Asia/Taipei",isRecurring:s.isRecurring||!1,recurrenceRule:s.recurrenceRule?JSON.parse(s.recurrenceRule):void 0}:void 0,categories:s.categories?s.categories.split(",").map(a=>({id:"",name:a.trim(),slug:a.trim().toLowerCase(),colorCode:"#3B82F6",icon:"📍"})).filter(a=>a.name):[]}),S=async()=>{C.value=!0,v.value=null;try{await L();const s=await B(D);if(s){if(t.value=$(s),t.value.location?.latitude&&t.value.location?.longitude){const a=await F(t.value.location.latitude,t.value.location.longitude,10);b.value=a.map($).filter(g=>g.id!==D)}}else v.value={message:"找不到活動"}}catch(s){v.value=s,console.error("載入活動失敗:",s)}finally{C.value=!1}},M=()=>{S()};at(()=>{S()}),it({title:q(()=>t.value?.name||"活動詳情"),meta:q(()=>[{name:"description",content:t.value?.summary||t.value?.description||""},{property:"og:title",content:t.value?.name||""},{property:"og:description",content:t.value?.summary||""},{property:"og:type",content:"article"}])});const k=s=>new Date(s).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}),j=(s,a)=>{const g=k(s);return!a||a===s?g:`${g} - ${k(a)}`},Y=(s,a)=>!s&&!a?"":s&&a?`${s} - ${a}`:s||a||"",H=s=>s.freq==="DAILY"?"每日":s.freq==="WEEKLY"?"每週":s.freq==="MONTHLY"?"每月":s.freq==="YEARLY"?"每年":"定期",V=s=>s<1e3?`${Math.round(s)}m`:`${(s/1e3).toFixed(1)}km`,O=async()=>{if(!t.value)return;const s={title:t.value.name,text:t.value.summary||t.value.description,url:window.location.href};try{navigator.share?await navigator.share(s):(await navigator.clipboard.writeText(window.location.href),pt.success("連結已複製到剪貼簿"))}catch(a){console.error("分享失敗:",a)}};if(v.value)throw lt({statusCode:v.value?.statusCode||404,statusMessage:v.value?.message||"找不到指定的活動"});return(s,a)=>{const g=Q,p=U,A=ot,J=yt,_=nt,y=dt,R=X,K=Et,P=bt,W=ht,z=At,w=Ct,G=Z;return n(),u("div",Rt,[e(C)?(n(),u("div",Dt,[o(p,{class:"w-full max-w-4xl mx-auto"},{default:l(()=>[o(g,{rows:8,animated:""})]),_:1})])):e(v)?(n(),u("div",$t,[o(J,{icon:"error",title:"載入失敗","sub-title":e(v).message||"無法載入活動詳情"},{extra:l(()=>[o(A,{type:"primary",onClick:a[0]||(a[0]=r=>M())},{default:l(()=>a[3]||(a[3]=[m("重試",-1)])),_:1,__:[3]}),o(A,{onClick:a[1]||(a[1]=r=>s.$router.push("/"))},{default:l(()=>a[4]||(a[4]=[m("返回首頁",-1)])),_:1,__:[4]})]),_:1},8,["sub-title"])])):e(t)?(n(),u("div",St,[o(K,{onBack:a[2]||(a[2]=()=>s.$router.back()),class:"bg-white shadow-sm"},{title:l(()=>[i("div",zt,[i("span",null,d(e(t).name),1),e(t).validation?.verified?(n(),f(y,{key:0,type:"success",size:"small"},{default:l(()=>[o(_,null,{default:l(()=>[o(e(ut))]),_:1}),a[5]||(a[5]=m(" 已驗證 ",-1))]),_:1,__:[5]})):c("",!0)])]),extra:l(()=>[o(R,null,{default:l(()=>[o(xt,{activity:e(t)},null,8,["activity"]),o(A,{onClick:O},{default:l(()=>[o(_,null,{default:l(()=>[o(e(rt))]),_:1}),a[6]||(a[6]=m(" 分享 ",-1))]),_:1,__:[6]})]),_:1})]),_:1}),o(G,{class:"max-w-6xl mx-auto p-6"},{default:l(()=>[o(w,{gutter:24},{default:l(()=>[o(z,{lg:16,md:24},{default:l(()=>[e(t).images&&e(t).images.length>0?(n(),f(p,{key:0,class:"mb-6"},{default:l(()=>[o(W,{height:"300px","indicator-position":"outside"},{default:l(()=>[(n(!0),u(x,null,h(e(t).images,r=>(n(),f(P,{key:r.id},{default:l(()=>[i("img",{src:r.url,alt:r.alt||e(t).name,class:"w-full h-full object-cover"},null,8,It)]),_:2},1024))),128))]),_:1})]),_:1})):c("",!0),o(p,{class:"mb-6"},{header:l(()=>a[7]||(a[7]=[i("h2",{class:"text-lg font-semibold"},"活動詳情",-1)])),default:l(()=>[e(t).summary?(n(),u("div",qt,[a[8]||(a[8]=i("h3",{class:"font-medium text-blue-800 mb-2"},"活動摘要",-1)),i("p",Nt,d(e(t).summary),1)])):c("",!0),e(t).description?(n(),u("div",Tt,[i("p",Bt,d(e(t).description),1)])):c("",!0),e(t).categories&&e(t).categories.length>0?(n(),u("div",Ft,[a[9]||(a[9]=i("h4",{class:"font-medium mb-2"},"活動分類",-1)),o(R,{wrap:""},{default:l(()=>[(n(!0),u(x,null,h(e(t).categories,r=>(n(),f(y,{key:r.id,color:r.colorCode,class:"text-white"},{default:l(()=>[r.icon?(n(),f(_,{key:0},{default:l(()=>[(n(),f(N(r.icon)))]),_:2},1024)):c("",!0),m(" "+d(r.name),1)]),_:2},1032,["color"]))),128))]),_:1})])):c("",!0)]),_:1}),e(t).location?(n(),f(p,{key:1,class:"mb-6"},{header:l(()=>[i("h2",Lt,[o(_,null,{default:l(()=>[o(e(ct))]),_:1}),a[10]||(a[10]=m(" 位置資訊 ",-1))])]),default:l(()=>[i("div",Mt,[i("div",null,[a[11]||(a[11]=i("h4",{class:"font-medium mb-2"},"地址",-1)),i("p",jt,d(e(t).location.address),1),i("p",Yt,d(e(t).location.district)+", "+d(e(t).location.city)+", "+d(e(t).location.region),1)]),e(t).location.venue?(n(),u("div",Ht,[a[12]||(a[12]=i("h4",{class:"font-medium mb-2"},"場地",-1)),i("p",Vt,d(e(t).location.venue),1)])):c("",!0),e(t).location.landmarks&&e(t).location.landmarks.length>0?(n(),u("div",Ot,[a[13]||(a[13]=i("h4",{class:"font-medium mb-2"},"鄰近地標",-1)),o(R,{wrap:""},{default:l(()=>[(n(!0),u(x,null,h(e(t).location.landmarks,r=>(n(),f(y,{key:r,type:"info",size:"small"},{default:l(()=>[m(d(r),1)]),_:2},1024))),128))]),_:1})])):c("",!0),i("div",Jt,[o(kt,{activities:[e(t)],center:{lat:e(t).location.latitude||0,lng:e(t).location.longitude||0},zoom:15,"show-controls":!1,class:"h-full"},null,8,["activities","center"])])])]),_:1})):c("",!0),e(t).source||e(t).validation?(n(),f(p,{key:2},{header:l(()=>[i("h2",Kt,[o(_,null,{default:l(()=>[o(e(_t))]),_:1}),a[14]||(a[14]=m(" 資料資訊 ",-1))])]),default:l(()=>[i("div",Pt,[e(t).source?(n(),u("div",Wt,[a[15]||(a[15]=i("h4",{class:"font-medium mb-2"},"資料來源",-1)),i("p",wt,d(e(t).source.website),1),i("p",Gt," 更新時間: "+d(k(e(t).source.crawledAt)),1)])):c("",!0),e(t).validation?(n(),u("div",Qt,[a[17]||(a[17]=i("h4",{class:"font-medium mb-2"},"驗證狀態",-1)),i("div",Ut,[o(_,{color:e(t).validation.verified?"#67C23A":"#F56C6C"},{default:l(()=>[(n(),f(N(e(t).validation.verified?"CircleCheckFilled":"CircleCloseFilled")))]),_:1},8,["color"]),i("span",{class:mt(e(t).validation.verified?"text-green-600":"text-red-600")},d(e(t).validation.verified?"已驗證":"未驗證"),3),o(y,{size:"small"},{default:l(()=>[m(" 品質分數: "+d(e(t).validation.qualityScore)+"% ",1)]),_:1})]),i("p",Xt," 驗證時間: "+d(e(t).validation.verificationDate?k(e(t).validation.verificationDate):"未知"),1),e(t).validation.issues&&e(t).validation.issues.length>0?(n(),u("div",Zt,[a[16]||(a[16]=i("h5",{class:"text-sm font-medium mb-1"},"發現問題:",-1)),i("ul",te,[(n(!0),u(x,null,h(e(t).validation.issues,(r,I)=>(n(),u("li",{key:`${r.field}-${I}`,class:"flex items-start gap-2"},[o(_,{class:"mt-0.5 text-orange-500"},{default:l(()=>[o(e(ft))]),_:1}),m(" "+d(r.message),1)]))),128))])])):c("",!0)])):c("",!0)])]),_:1})):c("",!0)]),_:1}),o(z,{lg:8,md:24},{default:l(()=>[e(t).time?(n(),f(p,{key:0,class:"mb-6 sticky top-6"},{header:l(()=>[i("h3",ee,[o(_,null,{default:l(()=>[o(e(T))]),_:1}),a[18]||(a[18]=m(" 活動時間 ",-1))])]),default:l(()=>[i("div",se,[i("div",null,[a[19]||(a[19]=i("h4",{class:"font-medium mb-2"},"活動日期",-1)),i("div",ae,[o(_,null,{default:l(()=>[o(e(T))]),_:1}),i("span",null,d(j(e(t).time.startDate,e(t).time.endDate)),1)])]),e(t).time.startTime||e(t).time.endTime?(n(),u("div",ie,[a[20]||(a[20]=i("h4",{class:"font-medium mb-2"},"活動時間",-1)),i("div",le,[o(_,null,{default:l(()=>[o(e(vt))]),_:1}),i("span",null,d(Y(e(t).time.startTime,e(t).time.endTime)),1)])])):c("",!0),e(t).time.isRecurring&&e(t).time.recurrenceRule?(n(),u("div",oe,[a[21]||(a[21]=i("h4",{class:"font-medium mb-2"},"重複週期",-1)),o(y,{type:"info"},{default:l(()=>[m(d(H(e(t).time.recurrenceRule)),1)]),_:1})])):c("",!0),e(t).time.timezone?(n(),u("div",ne," 時區: "+d(e(t).time.timezone),1)):c("",!0)])]),_:1})):c("",!0),e(b)&&e(b).length>0?(n(),f(p,{key:1},{header:l(()=>a[22]||(a[22]=[i("h3",{class:"text-lg font-semibold"},"附近活動",-1)])),default:l(()=>[i("div",re,[(n(!0),u(x,null,h(e(b).slice(0,5),r=>(n(),u("div",{key:r.id,class:"p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:I=>s.$router.push(`/activity/${r.id}`)},[i("h4",ue,d(r.name),1),i("p",ce,d(r.summary),1),i("div",me,[i("span",null,d(r.location?.city),1),r.distance?(n(),u("span",fe,d(V(r.distance)),1)):c("",!0)])],8,de))),128))])]),_:1})):c("",!0)]),_:1})]),_:1})]),_:1})])):c("",!0)])}}}),ke=gt(_e,[["__scopeId","data-v-c7e3ae48"]]);export{ke as default};
