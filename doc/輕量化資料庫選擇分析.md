# è¼•é‡åŒ–è³‡æ–™åº«é¸æ“‡åˆ†æ

## 1. æ–¹æ¡ˆå°æ¯”ç¸½è¡¨

| æ–¹æ¡ˆ | è¨­ç½®è¤‡é›œåº¦ | åœ°ç†æ”¯æ´ | ORM ç›¸å®¹æ€§ | éƒ¨ç½²ä¾¿åˆ©æ€§ | æˆæœ¬ | æ¨è–¦åº¦ |
|------|------------|----------|------------|------------|------|--------|
| **SQLite + SpatiaLite** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å…è²» | â­â­â­â­â­ |
| PostgreSQL + PostGIS | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | ä¸­ç­‰ | â­â­â­ |
| MongoDB | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | ä½-ä¸­ | â­â­ |

## 2. è©³ç´°åˆ†æ

### 2.1 SQLite + SpatiaLiteï¼ˆå¼·çƒˆæ¨è–¦ï¼‰

#### å„ªå‹¢
```yaml
é›¶é…ç½®éƒ¨ç½²:
  - å–®ä¸€æ–‡ä»¶è³‡æ–™åº«
  - ç„¡éœ€é¡å¤–æœå‹™å™¨
  - é©åˆ Vercel/Netlify éƒ¨ç½²

è¼•é‡é«˜æ•ˆ:
  - è³‡æ–™åº«æ–‡ä»¶å¤§å°: <100MB
  - æŸ¥è©¢é€Ÿåº¦: æ¯«ç§’ç´š
  - è¨˜æ†¶é«”ä½¿ç”¨: æœ€å°åŒ–

åœ°ç†åŠŸèƒ½:
  - SpatiaLite æä¾›å®Œæ•´ GIS æ”¯æ´
  - è·é›¢è¨ˆç®—ã€ç©ºé–“æŸ¥è©¢
  - èˆ‡ PostGIS åŠŸèƒ½ç›¸è¿‘

é–‹ç™¼ä¾¿åˆ©:
  - æœ¬åœ°é–‹ç™¼ç„¡éœ€å®‰è£æœå‹™
  - å‚™ä»½å°±æ˜¯è¤‡è£½æ–‡ä»¶
  - ç‰ˆæœ¬æ§åˆ¶å‹å–„
```

#### é™åˆ¶
```yaml
ä¸¦ç™¼é™åˆ¶:
  - é©åˆè®€å¤šå¯«å°‘å ´æ™¯
  - åŒæ™‚å¯«å…¥é™åˆ¶

æ“´å±•æ€§:
  - å–®ä¸€æ–‡ä»¶é™åˆ¶
  - ä¸é©åˆè¶…å¤§è¦æ¨¡æ‡‰ç”¨

åŠŸèƒ½é™åˆ¶:
  - æ²’æœ‰ç”¨æˆ¶æ¬Šé™ç³»çµ±
  - è§¸ç™¼å™¨åŠŸèƒ½æœ‰é™
```

#### å¯¦ä½œç¯„ä¾‹
```typescript
// drizzle.config.ts
export default {
  schema: './db/schema.ts',
  out: './db/migrations',
  driver: 'better-sqlite',
  dbCredentials: {
    url: './data/tourism.db'
  }
} satisfies Config;

// åœ°ç†æŸ¥è©¢ç¯„ä¾‹
const nearbyActivities = await db.execute(sql`
  SELECT a.*, l.*, 
    Distance(
      MakePoint(${userLng}, ${userLat}, 4326),
      MakePoint(l.longitude, l.latitude, 4326)
    ) / 1000 as distance_km
  FROM activities a
  JOIN locations l ON a.id = l.activity_id
  WHERE Distance(
    MakePoint(${userLng}, ${userLat}, 4326),
    MakePoint(l.longitude, l.latitude, 4326)
  ) / 1000 <= ${radiusKm}
  ORDER BY distance_km
`);
```

### 2.2 PostgreSQL + PostGISï¼ˆä¼æ¥­ç´šé¸æ“‡ï¼‰

#### å„ªå‹¢
```yaml
åŠŸèƒ½å®Œæ•´:
  - å®Œæ•´çš„ SQL æ¨™æº–æ”¯æ´
  - å¼·å¤§çš„åœ°ç†ç©ºé–“åŠŸèƒ½
  - è¤‡é›œæŸ¥è©¢å„ªåŒ–

æ“´å±•æ€§:
  - æ”¯æ´å¤§é‡ä¸¦ç™¼
  - æ©«å‘æ“´å±•èƒ½åŠ›
  - ä¼æ¥­ç´šå¯é æ€§

ç”Ÿæ…‹ç³»çµ±:
  - è±å¯Œçš„æ“´å±•æ’ä»¶
  - å®Œæ•´çš„ç›£æ§å·¥å…·
  - æˆç†Ÿçš„å‚™ä»½æ–¹æ¡ˆ
```

#### åŠ£å‹¢
```yaml
è¤‡é›œåº¦é«˜:
  - éœ€è¦é¡å¤–æœå‹™å™¨ç®¡ç†
  - é…ç½®è¤‡é›œ
  - éƒ¨ç½²æˆæœ¬é«˜

è³‡æºéœ€æ±‚:
  - è¨˜æ†¶é«”ä½¿ç”¨è¼ƒé«˜
  - ç£ç¢Ÿç©ºé–“éœ€æ±‚å¤§
  - éœ€è¦å°ˆæ¥­ç¶­è­·
```

### 2.3 MongoDBï¼ˆæ–‡æª”å‹é¸æ“‡ï¼‰

#### å„ªå‹¢
```yaml
éˆæ´»æ€§:
  - Schema-less è¨­è¨ˆ
  - JSON åŸç”Ÿæ”¯æ´
  - å¿«é€Ÿè¿­ä»£é–‹ç™¼

é›²ç«¯å‹å–„:
  - MongoDB Atlas æ‰˜ç®¡æœå‹™
  - è‡ªå‹•æ“´å±•
  - å…§å»ºå®‰å…¨åŠŸèƒ½
```

#### åŠ£å‹¢
```yaml
åœ°ç†åŠŸèƒ½:
  - GeoJSON æ”¯æ´æœ‰é™
  - è¤‡é›œç©ºé–“æŸ¥è©¢è¼ƒå¼±
  - è·é›¢è¨ˆç®—ç²¾åº¦ä¸å¦‚ PostGIS

å­¸ç¿’æˆæœ¬:
  - NoSQL æŸ¥è©¢èªæ³•
  - ç´¢å¼•è¨­è¨ˆè€ƒé‡
  - é—œè¯æŸ¥è©¢è¤‡é›œ
```

## 3. ORM é¸æ“‡åˆ†æ

### 3.1 Drizzle ORMï¼ˆæ¨è–¦ï¼‰

```typescript
// å‹åˆ¥å®‰å…¨ã€æ•ˆèƒ½å„ªç•°
import { eq, and, sql } from 'drizzle-orm';

// ç°¡æ½”çš„æŸ¥è©¢èªæ³•
const activities = await db
  .select()
  .from(activitiesTable)
  .where(
    and(
      eq(activitiesTable.status, 'active'),
      sql`${activitiesTable.createdAt} > ${yesterday}`
    )
  );
```

**å„ªå‹¢ï¼š**
- TypeScript åŸç”Ÿæ”¯æ´
- é›¶ runtime overhead
- SQL-like èªæ³•ç›´è§€
- è¼•é‡ç´šï¼Œæ‰“åŒ…é«”ç©å°

### 3.2 Prismaï¼ˆåŠŸèƒ½è±å¯Œï¼‰

```typescript
// åŠŸèƒ½å®Œæ•´ä½†ç›¸å°è¼ƒé‡
const activities = await prisma.activity.findMany({
  where: {
    status: 'active',
    createdAt: {
      gte: yesterday
    }
  },
  include: {
    location: true,
    categories: true
  }
});
```

**å„ªå‹¢ï¼š**
- åœ–å½¢åŒ–ä»‹é¢
- è‡ªå‹•é·ç§»
- å‹åˆ¥è‡ªå‹•ç”Ÿæˆ

**åŠ£å‹¢ï¼š**
- æ‰“åŒ…é«”ç©è¼ƒå¤§
- Runtime ä¾è³´å¤š

### 3.3 TypeORMï¼ˆä¼æ¥­ç´šï¼‰

**å„ªå‹¢ï¼š**
- è£é£¾å™¨èªæ³•
- åŠŸèƒ½æœ€å®Œæ•´
- æ”¯æ´å¤šç¨®è³‡æ–™åº«

**åŠ£å‹¢ï¼š**
- å­¸ç¿’æ›²ç·šé™¡å³­
- é…ç½®è¤‡é›œ
- è¼ƒé‡çš„æ¡†æ¶

## 4. é‡å°è§€å…‰åœ°åœ–çš„æœ€ä½³é¸æ“‡

### 4.1 æ¨è–¦æ–¹æ¡ˆï¼šSQLite + Drizzle

```typescript
// å®Œæ•´çš„å¯¦ä½œç¯„ä¾‹
// db/schema.ts
export const activities = sqliteTable('activities', {
  id: text('id').primaryKey(),
  name: text('name').notNull(),
  description: text('description'),
  status: text('status').default('active'),
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
});

export const locations = sqliteTable('locations', {
  id: text('id').primaryKey(),
  activityId: text('activity_id').references(() => activities.id),
  address: text('address').notNull(),
  latitude: real('latitude').notNull(),
  longitude: real('longitude').notNull(),
});

// server/api/activities/nearby.get.ts
export default defineEventHandler(async (event) => {
  const { lat, lng, radius = 10 } = getQuery(event);
  
  const nearbyActivities = await db.execute(sql`
    SELECT 
      a.*,
      l.address,
      l.latitude,
      l.longitude,
      Distance(
        MakePoint(${lng}, ${lat}, 4326),
        MakePoint(l.longitude, l.latitude, 4326)
      ) / 1000 as distance_km
    FROM activities a
    JOIN locations l ON a.id = l.activity_id
    WHERE a.status = 'active'
      AND Distance(
        MakePoint(${lng}, ${lat}, 4326),
        MakePoint(l.longitude, l.latitude, 4326)
      ) / 1000 <= ${radius}
    ORDER BY distance_km
    LIMIT 50
  `);
  
  return nearbyActivities;
});
```

### 4.2 è³‡æ–™é‡è©•ä¼°

```yaml
é ä¼°è³‡æ–™é‡:
  - æ´»å‹•è³‡æ–™: 10,000 ç­† (~5MB)
  - åœ°é»è³‡æ–™: 10,000 ç­† (~3MB)
  - åˆ†é¡é—œè¯: 20,000 ç­† (~1MB)
  - ç´¢å¼•æ–‡ä»¶: (~5MB)
  - ç¸½è¨ˆ: ~15MB

SQLite é©ç”¨ç¯„åœ:
  - è³‡æ–™é‡: < 1TB (é è¶…éœ€æ±‚)
  - ä¸¦ç™¼è®€å–: æ•¸åƒå€‹é€£æ¥
  - æŸ¥è©¢æ•ˆèƒ½: æ¯«ç§’ç´šå›æ‡‰
```

## 5. å¯¦éš›éƒ¨ç½²è€ƒé‡

### 5.1 Vercel éƒ¨ç½²é™åˆ¶

```yaml
Vercel Limitations:
  - Serverless Functions: 50MB é™åˆ¶
  - åŸ·è¡Œæ™‚é–“: 10s é™åˆ¶ (Hobby), 5min (Pro)
  - è¨˜æ†¶é«”: 1GB é™åˆ¶
  
SQLite ç›¸å®¹æ€§:
  - æ–‡ä»¶å¤§å°: âœ… (<50MB)
  - è®€å–æ•ˆèƒ½: âœ… (æ¯«ç§’ç´š)
  - ç„¡æŒä¹…å¯«å…¥: âš ï¸ (è®€å¤šå¯«å°‘å ´æ™¯é©ç”¨)
```

### 5.2 æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚éœ€å¯«å…¥é »ç¹ï¼‰

```yaml
Vercel + PlanetScale:
  - MySQL ç›¸å®¹
  - Serverless æ¶æ§‹
  - è‡ªå‹•æ“´å±•
  - åœ°ç†æŸ¥è©¢æ”¯æ´ (MySQL 8.0+)

Vercel + Supabase:
  - PostgreSQL + PostGIS
  - RESTful API
  - å³æ™‚è¨‚é–±åŠŸèƒ½
  - å…è²»é¡åº¦å……è¶³
```

## 6. æœ€çµ‚å»ºè­°

### ğŸ¯ éšæ®µæ€§å¯¦ä½œç­–ç•¥

**ç¬¬ä¸€éšæ®µï¼šMVP (SQLite + Drizzle)**
- å¿«é€Ÿé–‹ç™¼å’Œéƒ¨ç½²
- é›¶é…ç½®ï¼Œå°ˆæ³¨åŠŸèƒ½é–‹ç™¼
- é©—è­‰ç”¢å“å¯è¡Œæ€§

**ç¬¬äºŒéšæ®µï¼šæ“´å±• (è¦–éœ€æ±‚é¸æ“‡)**
- å¦‚æœè®€å¯«æ¯”ä¾‹åˆé©ï¼šç¹¼çºŒ SQLite
- å¦‚æœéœ€è¦é«˜ä¸¦ç™¼å¯«å…¥ï¼šé·ç§»åˆ° PlanetScale
- å¦‚æœéœ€è¦è¤‡é›œåœ°ç†æŸ¥è©¢ï¼šå‡ç´šåˆ° PostgreSQL

### ğŸ’° æˆæœ¬æ¯”è¼ƒ

```yaml
SQLite + Drizzle:
  - é–‹ç™¼æˆæœ¬: æœ€ä½
  - ç¶­è­·æˆæœ¬: æœ€ä½
  - éƒ¨ç½²æˆæœ¬: å…è²» (Vercel)

PlanetScale:
  - é–‹ç™¼æˆæœ¬: ä½
  - ç¶­è­·æˆæœ¬: ä½
  - éƒ¨ç½²æˆæœ¬: $29/æœˆèµ·

PostgreSQL è‡ªç®¡:
  - é–‹ç™¼æˆæœ¬: ä¸­ç­‰
  - ç¶­è­·æˆæœ¬: é«˜
  - éƒ¨ç½²æˆæœ¬: $20-100/æœˆ
```

**çµè«–**ï¼šå°æ–¼æ‚¨çš„è§€å…‰æ´»å‹•åœ°åœ–éœ€æ±‚ï¼Œ**SQLite + Drizzle** æ˜¯æœ€é©åˆçš„é¸æ“‡ï¼Œæä¾›äº†å®Œç¾çš„è¼•é‡åŒ–ã€åŠŸèƒ½æ€§å’Œé–‹ç™¼æ•ˆç‡å¹³è¡¡ã€‚