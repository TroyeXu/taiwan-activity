# ç¯©é¸æ©Ÿåˆ¶å„ªåŒ–è¨­è¨ˆæ–‡ä»¶

## 1. ç¯©é¸ç³»çµ±æ¦‚è¿°

### 1.1 è¨­è¨ˆç›®æ¨™
- æä¾›ç›´è§€æ˜“ç”¨çš„ç¯©é¸ä»‹é¢
- æ”¯æ´å¤šç¶­åº¦å¿«é€Ÿç¯©é¸
- å³æ™‚é¡¯ç¤ºç¯©é¸çµæœ
- æ™ºæ…§æ¨è–¦ç›¸é—œæ´»å‹•

### 1.2 æ ¸å¿ƒåŸå‰‡
- **æ¼¸é€²å¼æ­éœ²**ï¼šå¾ç°¡å–®åˆ°è¤‡é›œçš„ç¯©é¸é¸é …
- **å³æ™‚å›é¥‹**ï¼šç¯©é¸çµæœå³æ™‚æ›´æ–°
- **ç‹€æ…‹ä¿æŒ**ï¼šè¨˜ä½ä½¿ç”¨è€…ç¯©é¸åå¥½
- **è¦–è¦ºåŒ–æç¤º**ï¼šæ¸…æ¥šé¡¯ç¤ºå·²é¸æ¢ä»¶å’Œçµæœæ•¸é‡

## 2. ç¯©é¸ç¶­åº¦å®šç¾©

### 2.1 ä¸»è¦ç¯©é¸ç¶­åº¦

#### 2.1.1 æ´»å‹•é¡å‹ï¼ˆå¿…é¸ç¶­åº¦ï¼‰
```javascript
const activityCategories = [
  {
    id: 'traditional',
    name: 'å‚³çµ±ç¯€æ…¶',
    icon: 'ğŸŠ',
    color: '#DC2626',
    keywords: ['ç¯€æ…¶', 'å»Ÿæœƒ', 'æ°‘ä¿—', 'å‚³çµ±', 'æ–‡åŒ–']
  },
  {
    id: 'romantic',
    name: 'æµªæ¼«ä¹‹æ—…',
    icon: 'ğŸ’•',
    color: '#EC4899',
    keywords: ['æƒ…ä¾¶', 'ç´„æœƒ', 'æµªæ¼«', 'å¤œæ™¯', 'å’–å•¡']
  },
  {
    id: 'art_culture',
    name: 'è—è¡“æ–‡åŒ–',
    icon: 'ğŸ­',
    color: '#7C3AED',
    keywords: ['å±•è¦½', 'è—è¡“', 'æ–‡åŒ–', 'åšç‰©é¤¨', 'è¡¨æ¼”']
  },
  {
    id: 'wellness',
    name: 'é¤Šç”Ÿæ¨‚æ´»',
    icon: 'ğŸ§˜',
    color: '#10B981',
    keywords: ['å¥åº·', 'ç‘œä¼½', 'æŒ‰æ‘©', 'æº«æ³‰', 'é‹å‹•']
  },
  {
    id: 'cuisine',
    name: 'ç¾é£Ÿé¥—å®´',
    icon: 'ğŸœ',
    color: '#F59E0B',
    keywords: ['ç¾é£Ÿ', 'é¤å»³', 'å°åƒ', 'å¤œå¸‚', 'æ–™ç†']
  },
  {
    id: 'nature',
    name: 'è‡ªç„¶ç”Ÿæ…‹',
    icon: 'ğŸŒ¿',
    color: '#059669',
    keywords: ['è‡ªç„¶', 'ç”Ÿæ…‹', 'ç™»å±±', 'æµ·é‚Š', 'å…¬åœ’']
  },
  {
    id: 'indigenous',
    name: 'åŸæ°‘æ…¶å…¸',
    icon: 'ğŸª¶',
    color: '#B91C1C',
    keywords: ['åŸä½æ°‘', 'éƒ¨è½', 'æ…¶å…¸', 'å‚³çµ±', 'æ–‡åŒ–']
  },
  {
    id: 'hakka',
    name: 'å®¢å®¶æ–‡åŒ–',
    icon: 'ğŸ®',
    color: '#1E40AF',
    keywords: ['å®¢å®¶', 'æ–‡åŒ–', 'å‚³çµ±', 'ç¯€æ…¶', 'ç¾é£Ÿ']
  }
];
```

#### 2.1.2 åœ°å€ç¯©é¸ï¼ˆæ”¯æ´å¤šå±¤ç´šï¼‰
```javascript
const regions = {
  north: {
    name: 'åŒ—éƒ¨åœ°å€',
    cities: [
      { id: 'taipei', name: 'å°åŒ—å¸‚', districts: ['ä¸­æ­£å€', 'å¤§åŒå€', 'ä¸­å±±å€', 'æ¾å±±å€', 'å¤§å®‰å€', 'è¬è¯å€', 'ä¿¡ç¾©å€', 'å£«æ—å€', 'åŒ—æŠ•å€', 'å…§æ¹–å€', 'å—æ¸¯å€', 'æ–‡å±±å€'] },
      { id: 'new_taipei', name: 'æ–°åŒ—å¸‚', districts: ['æ¿æ©‹å€', 'ä¸‰é‡å€', 'ä¸­å’Œå€', 'æ°¸å’Œå€', 'æ–°èŠå€', 'æ–°åº—å€', 'æ¨¹æ—å€', 'é¶¯æ­Œå€', 'ä¸‰å³½å€', 'æ·¡æ°´å€'] },
      { id: 'keelung', name: 'åŸºéš†å¸‚' },
      { id: 'taoyuan', name: 'æ¡ƒåœ’å¸‚' },
      { id: 'hsinchu_city', name: 'æ–°ç«¹å¸‚' },
      { id: 'hsinchu_county', name: 'æ–°ç«¹ç¸£' }
    ]
  },
  central: {
    name: 'ä¸­éƒ¨åœ°å€',
    cities: [
      { id: 'miaoli', name: 'è‹—æ —ç¸£' },
      { id: 'taichung', name: 'å°ä¸­å¸‚' },
      { id: 'changhua', name: 'å½°åŒ–ç¸£' },
      { id: 'nantou', name: 'å—æŠ•ç¸£' },
      { id: 'yunlin', name: 'é›²æ—ç¸£' }
    ]
  },
  south: {
    name: 'å—éƒ¨åœ°å€',
    cities: [
      { id: 'chiayi_county', name: 'å˜‰ç¾©ç¸£' },
      { id: 'chiayi_city', name: 'å˜‰ç¾©å¸‚' },
      { id: 'tainan', name: 'å°å—å¸‚' },
      { id: 'kaohsiung', name: 'é«˜é›„å¸‚' },
      { id: 'pingtung', name: 'å±æ±ç¸£' }
    ]
  },
  east: {
    name: 'æ±éƒ¨åœ°å€',
    cities: [
      { id: 'yilan', name: 'å®œè˜­ç¸£' },
      { id: 'hualien', name: 'èŠ±è“®ç¸£' },
      { id: 'taitung', name: 'å°æ±ç¸£' }
    ]
  },
  islands: {
    name: 'é›¢å³¶åœ°å€',
    cities: [
      { id: 'penghu', name: 'æ¾æ¹–ç¸£' },
      { id: 'kinmen', name: 'é‡‘é–€ç¸£' },
      { id: 'lienchiang', name: 'é€£æ±Ÿç¸£' }
    ]
  }
};
```

#### 2.1.3 æ™‚é–“ç¯©é¸
```javascript
const timeFilters = {
  // å¿«é€Ÿé¸é …
  quick: [
    { id: 'today', name: 'ä»Šå¤©', value: 0 },
    { id: 'tomorrow', name: 'æ˜å¤©', value: 1 },
    { id: 'this_week', name: 'æœ¬é€±', value: 'week' },
    { id: 'this_weekend', name: 'æœ¬é€±æœ«', value: 'weekend' },
    { id: 'next_week', name: 'ä¸‹é€±', value: 'next_week' },
    { id: 'this_month', name: 'æœ¬æœˆ', value: 'month' }
  ],
  
  // è‡ªè¨‚æ—¥æœŸç¯„åœ
  custom: {
    startDate: null,
    endDate: null,
    includeOngoing: true  // åŒ…å«é€²è¡Œä¸­çš„æ´»å‹•
  },
  
  // æ™‚æ®µç¯©é¸
  timeOfDay: [
    { id: 'morning', name: 'ä¸Šåˆ (06:00-12:00)', start: '06:00', end: '12:00' },
    { id: 'afternoon', name: 'ä¸‹åˆ (12:00-18:00)', start: '12:00', end: '18:00' },
    { id: 'evening', name: 'æ™šä¸Š (18:00-24:00)', start: '18:00', end: '24:00' }
  ]
};
```

### 2.2 é€²éšç¯©é¸ç¶­åº¦

#### 2.2.1 è·é›¢èˆ‡ä½ç½®
```javascript
const locationFilters = {
  // è·é›¢ç¯©é¸
  distance: [
    { id: 'nearby', name: 'é™„è¿‘ (2km)', radius: 2000 },
    { id: 'walking', name: 'æ­¥è¡Œå¯é” (5km)', radius: 5000 },
    { id: 'cycling', name: 'é¨è»Šå¯é” (10km)', radius: 10000 },
    { id: 'driving', name: 'é–‹è»Šå¯é” (30km)', radius: 30000 },
    { id: 'unlimited', name: 'ä¸é™è·é›¢', radius: null }
  ],
  
  // äº¤é€šä¾¿åˆ©æ€§
  transportation: [
    { id: 'mrt_accessible', name: 'æ·é‹å¯é”' },
    { id: 'bus_accessible', name: 'å…¬è»Šå¯é”' },
    { id: 'parking_available', name: 'æœ‰åœè»Šå ´' },
    { id: 'bike_friendly', name: 'è‡ªè¡Œè»Šå‹å–„' }
  ]
};
```

#### 2.2.2 æ´»å‹•ç‰¹æ€§
```javascript
const activityFeatures = {
  // åƒèˆ‡æ–¹å¼
  participation: [
    { id: 'free', name: 'å…è²»æ´»å‹•', icon: 'ğŸ†“' },
    { id: 'paid', name: 'ä»˜è²»æ´»å‹•', icon: 'ğŸ’°' },
    { id: 'registration_required', name: 'éœ€è¦å ±å', icon: 'ğŸ“' },
    { id: 'walk_in', name: 'è‡ªç”±åƒåŠ ', icon: 'ğŸš¶' }
  ],
  
  // é©åˆå°è±¡
  suitableFor: [
    { id: 'family', name: 'è¦ªå­æ´»å‹•', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' },
    { id: 'couples', name: 'æƒ…ä¾¶ç´„æœƒ', icon: 'ğŸ’‘' },
    { id: 'seniors', name: 'éŠ€é«®æ—', icon: 'ğŸ‘´' },
    { id: 'youth', name: 'é’å°‘å¹´', icon: 'ğŸ‘¦' },
    { id: 'solo', name: 'å€‹äººåƒèˆ‡', icon: 'ğŸ™‹' }
  ],
  
  // æ´»å‹•è¦æ¨¡
  scale: [
    { id: 'intimate', name: 'å°å‹èšæœƒ (<50äºº)', max: 50 },
    { id: 'medium', name: 'ä¸­å‹æ´»å‹• (50-500äºº)', min: 50, max: 500 },
    { id: 'large', name: 'å¤§å‹æ´»å‹• (>500äºº)', min: 500 }
  ]
};
```

## 3. ç¯©é¸ä»‹é¢è¨­è¨ˆ

### 3.1 æ¡Œé¢ç‰ˆç¯©é¸é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯©é¸æ¢ä»¶                     [é‡ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ä½ç½®                             â”‚
â”‚ â—‹ ä½¿ç”¨ç›®å‰ä½ç½®   [ğŸ“ å–å¾—ä½ç½®]     â”‚
â”‚ â—‹ æ‰‹å‹•é¸æ“‡       [ğŸ” æœå°‹åœ°é»]     â”‚
â”‚                                     â”‚
â”‚ ğŸ“ è·é›¢ç¯„åœ                         â”‚
â”‚ â—â—‹â—‹â—‹â—‹ é™„è¿‘2km                     â”‚
â”‚                                     â”‚
â”‚ ğŸ­ æ´»å‹•é¡å‹                         â”‚
â”‚ â˜‘ï¸ å‚³çµ±ç¯€æ…¶  â˜‘ï¸ æµªæ¼«ä¹‹æ—…            â”‚
â”‚ â˜‘ï¸ è—è¡“æ–‡åŒ–  â˜ é¤Šç”Ÿæ¨‚æ´»            â”‚
â”‚ â˜ ç¾é£Ÿé¥—å®´  â˜ è‡ªç„¶ç”Ÿæ…‹            â”‚
â”‚ â˜ åŸæ°‘æ…¶å…¸  â˜ å®¢å®¶æ–‡åŒ–            â”‚
â”‚ [å…¨é¸] [æ¸…é™¤]                       â”‚
â”‚                                     â”‚
â”‚ ğŸ“… æ™‚é–“                             â”‚
â”‚ å¿«é€Ÿé¸é …ï¼š                          â”‚
â”‚ [ä»Šå¤©] [æ˜å¤©] [æœ¬é€±æœ«] [æœ¬æœˆ]       â”‚
â”‚                                     â”‚
â”‚ è‡ªè¨‚æ—¥æœŸï¼š                          â”‚
â”‚ å¾ [2025/01/22] åˆ° [2025/01/29]   â”‚
â”‚ â˜‘ï¸ åŒ…å«é€²è¡Œä¸­çš„æ´»å‹•                 â”‚
â”‚                                     â”‚
â”‚ ğŸŒ åœ°å€ â–¼                          â”‚
â”‚ â˜‘ï¸ åŒ—éƒ¨åœ°å€                         â”‚
â”‚   â˜‘ï¸ å°åŒ—å¸‚                         â”‚
â”‚     â˜ ä¸­æ­£å€  â˜ å¤§åŒå€             â”‚
â”‚     â˜‘ï¸ ä¿¡ç¾©å€  â˜ æ¾å±±å€             â”‚
â”‚   â˜ æ–°åŒ—å¸‚                         â”‚
â”‚   â˜ æ¡ƒåœ’å¸‚                         â”‚
â”‚                                     â”‚
â”‚ âš™ï¸ æ›´å¤šç¯©é¸ â–¼                       â”‚
â”‚ ğŸ’° è²»ç”¨                             â”‚
â”‚ â˜‘ï¸ å…è²»æ´»å‹•  â˜ ä»˜è²»æ´»å‹•             â”‚
â”‚                                     â”‚
â”‚ ğŸ‘¥ é©åˆå°è±¡                         â”‚
â”‚ â˜‘ï¸ è¦ªå­æ´»å‹•  â˜ æƒ…ä¾¶ç´„æœƒ             â”‚
â”‚                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ æ‰¾åˆ° 25 å€‹ç¬¦åˆçš„æ´»å‹•                â”‚
â”‚ [å¥—ç”¨ç¯©é¸]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ‰‹æ©Ÿç‰ˆç¯©é¸ä»‹é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ ç¯©é¸æ¢ä»¶            [é‡ç½®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚ ğŸ“ ä½ç½®èˆ‡è·é›¢               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¯ å°åŒ—å¸‚ä¿¡ç¾©å€        â”‚ â”‚
â”‚ â”‚ ğŸ“ é™„è¿‘ 2 å…¬é‡Œ          â”‚ â”‚
â”‚ â”‚ [è®Šæ›´ä½ç½®]             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ ğŸ­ æ´»å‹•é¡å‹ï¼ˆå¯å¤šé¸ï¼‰       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜‘ï¸ğŸŠ å‚³çµ±ç¯€æ…¶           â”‚ â”‚
â”‚ â”‚ â˜‘ï¸ğŸ’• æµªæ¼«ä¹‹æ—…           â”‚ â”‚
â”‚ â”‚ â˜ğŸ­ è—è¡“æ–‡åŒ–           â”‚ â”‚
â”‚ â”‚ â˜ğŸ§˜ é¤Šç”Ÿæ¨‚æ´»           â”‚ â”‚
â”‚ â”‚ â˜ğŸœ ç¾é£Ÿé¥—å®´           â”‚ â”‚
â”‚ â”‚ â˜ğŸŒ¿ è‡ªç„¶ç”Ÿæ…‹           â”‚ â”‚
â”‚ â”‚ â˜ğŸª¶ åŸæ°‘æ…¶å…¸           â”‚ â”‚
â”‚ â”‚ â˜ğŸ® å®¢å®¶æ–‡åŒ–           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ ğŸ“… æ™‚é–“                     â”‚
â”‚ å¿«é€Ÿé¸é …ï¼š                  â”‚
â”‚ [ä»Šå¤©] [æ˜å¤©] [æœ¬é€±æœ«]      â”‚
â”‚ [è‡ªè¨‚æ—¥æœŸç¯„åœ...]          â”‚
â”‚                             â”‚
â”‚ ğŸŒ åœ°å€                     â”‚
â”‚ [é¸æ“‡åœ°å€...]              â”‚
â”‚                             â”‚
â”‚ âš™ï¸ æ›´å¤šç¯©é¸                 â”‚
â”‚ [è²»ç”¨] [é©åˆå°è±¡] [å…¶ä»–]    â”‚
â”‚                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ æ‰¾åˆ° 25 å€‹æ´»å‹•              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚     æŸ¥çœ‹çµæœ (25)        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. ç¯©é¸é‚è¼¯èˆ‡æ¼”ç®—æ³•

### 4.1 ç¯©é¸æ¬Šé‡ç³»çµ±

```javascript
const filterWeights = {
  // æ ¸å¿ƒç¯©é¸ï¼ˆå¿…é ˆæ»¿è¶³ï¼‰
  core: {
    category: 1.0,        // æ´»å‹•é¡å‹
    location: 1.0,        // åœ°ç†ä½ç½®
    date: 1.0             // æ™‚é–“ç¯„åœ
  },
  
  // åå¥½ç¯©é¸ï¼ˆå½±éŸ¿æ’åºï¼‰
  preference: {
    distance: 0.3,        // è·é›¢åå¥½
    timeOfDay: 0.2,       // æ™‚æ®µåå¥½
    features: 0.25,       // æ´»å‹•ç‰¹æ€§
    popularity: 0.25      // å—æ­¡è¿ç¨‹åº¦
  }
};
```

### 4.2 æ™ºæ…§æ¨è–¦æ¼”ç®—æ³•

```javascript
class SmartRecommendation {
  // åŸºæ–¼ä½¿ç”¨è€…è¡Œç‚ºçš„æ¨è–¦
  getUserBasedRecommendation(userId, currentFilters) {
    const userHistory = this.getUserHistory(userId);
    const preferences = this.analyzePreferences(userHistory);
    
    return this.adjustFilters(currentFilters, preferences);
  }
  
  // åŸºæ–¼åœ°ç†ä½ç½®çš„æ¨è–¦
  getLocationBasedRecommendation(lat, lng, radius) {
    const nearbyPopular = this.getPopularActivitiesNearby(lat, lng, radius);
    const seasonalEvents = this.getSeasonalEvents();
    
    return this.combineRecommendations(nearbyPopular, seasonalEvents);
  }
  
  // åŸºæ–¼æ™‚é–“çš„æ¨è–¦
  getTimeBasedRecommendation(date, timeOfDay) {
    const upcomingEvents = this.getUpcomingEvents(date);
    const timeAppropriate = this.filterByTimeOfDay(upcomingEvents, timeOfDay);
    
    return timeAppropriate.sort((a, b) => b.relevanceScore - a.relevanceScore);
  }
}
```

### 4.3 çµæœæ’åºç­–ç•¥

```javascript
const sortingStrategies = {
  relevance: {
    name: 'æœ€ç›¸é—œ',
    algorithm: (activities, filters, userContext) => {
      return activities.map(activity => ({
        ...activity,
        score: this.calculateRelevanceScore(activity, filters, userContext)
      })).sort((a, b) => b.score - a.score);
    }
  },
  
  distance: {
    name: 'è·é›¢æœ€è¿‘',
    algorithm: (activities, userLocation) => {
      return activities.sort((a, b) => 
        this.calculateDistance(a.location, userLocation) - 
        this.calculateDistance(b.location, userLocation)
      );
    }
  },
  
  popularity: {
    name: 'æœ€å—æ­¡è¿',
    algorithm: (activities) => {
      return activities.sort((a, b) => 
        (b.viewCount + b.favoriteCount) - (a.viewCount + a.favoriteCount)
      );
    }
  },
  
  date: {
    name: 'æ™‚é–“æœ€è¿‘',
    algorithm: (activities) => {
      const now = new Date();
      return activities.sort((a, b) => 
        Math.abs(new Date(a.startDate) - now) - 
        Math.abs(new Date(b.startDate) - now)
      );
    }
  }
};
```

## 5. ç¯©é¸ç‹€æ…‹ç®¡ç†

### 5.1 ç¯©é¸ç‹€æ…‹çµæ§‹

```typescript
interface FilterState {
  // åŸºæœ¬ç¯©é¸
  categories: string[];
  regions: {
    [regionId: string]: {
      selected: boolean;
      cities: {
        [cityId: string]: {
          selected: boolean;
          districts?: string[];
        };
      };
    };
  };
  dateRange: {
    type: 'quick' | 'custom';
    quickOption?: string;
    startDate?: Date;
    endDate?: Date;
    includeOngoing: boolean;
  };
  
  // ä½ç½®ç¯©é¸
  location: {
    type: 'current' | 'custom';
    coordinates?: { lat: number; lng: number };
    address?: string;
    radius: number;
  };
  
  // é€²éšç¯©é¸
  advanced: {
    features: string[];
    priceRange: { min: number; max: number };
    suitableFor: string[];
    transportation: string[];
  };
  
  // é¡¯ç¤ºè¨­å®š
  sorting: 'relevance' | 'distance' | 'popularity' | 'date';
  resultLimit: number;
  
  // å…ƒè³‡æ–™
  metadata: {
    lastUpdated: Date;
    resultCount: number;
    searchId: string;
  };
}
```

### 5.2 ç¯©é¸ç‹€æ…‹æŒä¹…åŒ–

```javascript
class FilterStateManager {
  // å„²å­˜ç¯©é¸ç‹€æ…‹
  saveState(filters) {
    const state = {
      ...filters,
      timestamp: Date.now(),
      version: FILTER_VERSION
    };
    
    // å„²å­˜åˆ°æœ¬åœ°å„²å­˜
    localStorage.setItem('tourismFilters', JSON.stringify(state));
    
    // å¦‚æœä½¿ç”¨è€…å·²ç™»å…¥ï¼ŒåŒæ­¥åˆ°ä¼ºæœå™¨
    if (this.isUserLoggedIn()) {
      this.syncToServer(state);
    }
  }
  
  // è¼‰å…¥ç¯©é¸ç‹€æ…‹
  loadState() {
    const saved = localStorage.getItem('tourismFilters');
    if (saved) {
      const state = JSON.parse(saved);
      
      // æª¢æŸ¥ç‰ˆæœ¬ç›¸å®¹æ€§
      if (state.version === FILTER_VERSION) {
        return this.validateState(state);
      }
    }
    
    return this.getDefaultState();
  }
  
  // åˆä½µä½¿ç”¨è€…åå¥½
  mergeUserPreferences(baseFilters, userPreferences) {
    return {
      ...baseFilters,
      categories: userPreferences.preferredCategories || baseFilters.categories,
      location: {
        ...baseFilters.location,
        radius: userPreferences.preferredRadius || baseFilters.location.radius
      },
      sorting: userPreferences.preferredSorting || baseFilters.sorting
    };
  }
}
```

## 6. æ•ˆèƒ½å„ªåŒ–

### 6.1 ç¯©é¸çµæœå¿«å–

```javascript
class FilterCache {
  constructor() {
    this.cache = new Map();
    this.maxCacheSize = 100;
    this.cacheTTL = 5 * 60 * 1000; // 5 åˆ†é˜
  }
  
  // ç”¢ç”Ÿå¿«å–éµ
  generateCacheKey(filters) {
    const normalized = this.normalizeFilters(filters);
    return btoa(JSON.stringify(normalized));
  }
  
  // å–å¾—å¿«å–çµæœ
  get(filters) {
    const key = this.generateCacheKey(filters);
    const cached = this.cache.get(key);
    
    if (cached && (Date.now() - cached.timestamp) < this.cacheTTL) {
      return cached.data;
    }
    
    return null;
  }
  
  // å„²å­˜å¿«å–çµæœ
  set(filters, results) {
    const key = this.generateCacheKey(filters);
    
    // æ¸…ç†éæœŸå¿«å–
    if (this.cache.size >= this.maxCacheSize) {
      this.cleanExpiredCache();
    }
    
    this.cache.set(key, {
      data: results,
      timestamp: Date.now()
    });
  }
}
```

### 6.2 å³æ™‚æœå°‹å„ªåŒ–

```javascript
class RealTimeFilter {
  constructor() {
    this.debounceTime = 300;
    this.pendingRequest = null;
  }
  
  // é˜²æŠ–å‹•æœå°‹
  search(filters, callback) {
    // å–æ¶ˆä¹‹å‰çš„è«‹æ±‚
    if (this.pendingRequest) {
      clearTimeout(this.pendingRequest);
    }
    
    // å»¶é²åŸ·è¡Œæœå°‹
    this.pendingRequest = setTimeout(async () => {
      try {
        const results = await this.performSearch(filters);
        callback(null, results);
      } catch (error) {
        callback(error, null);
      }
    }, this.debounceTime);
  }
  
  // æ¼¸é€²å¼è¼‰å…¥çµæœ
  async loadResults(filters, page = 1, limit = 20) {
    const offset = (page - 1) * limit;
    
    const response = await fetch('/api/activities/search', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        filters,
        pagination: { offset, limit }
      })
    });
    
    return await response.json();
  }
}
```

## 7. ä½¿ç”¨è€…é«”é©—å„ªåŒ–

### 7.1 ç¯©é¸æç¤ºèˆ‡å¼•å°

```javascript
const filterGuidance = {
  // é¦–æ¬¡ä½¿ç”¨å¼•å°
  firstTimeUser: {
    steps: [
      {
        target: '.category-filter',
        title: 'é¸æ“‡ä½ æ„Ÿèˆˆè¶£çš„æ´»å‹•é¡å‹',
        description: 'å¯ä»¥é¸æ“‡å¤šå€‹é¡å‹ä¾†ç™¼ç¾æ›´å¤šç²¾å½©æ´»å‹•'
      },
      {
        target: '.location-filter',
        title: 'è¨­å®šä½ çš„ä½ç½®',
        description: 'è®“æˆ‘å€‘ç‚ºä½ æ¨è–¦é™„è¿‘çš„æ´»å‹•'
      },
      {
        target: '.date-filter',
        title: 'é¸æ“‡æ™‚é–“ç¯„åœ',
        description: 'å¯ä»¥ç”¨å¿«é€Ÿé¸é …æˆ–è‡ªè¨‚æ—¥æœŸ'
      }
    ]
  },
  
  // æ™ºæ…§å»ºè­°
  suggestions: {
    noResults: [
      'è©¦è©¦æ“´å¤§æœå°‹ç¯„åœ',
      'é¸æ“‡æ›´å¤šæ´»å‹•é¡å‹',
      'èª¿æ•´æ™‚é–“ç¯„åœ',
      'è€ƒæ…®é™„è¿‘çš„å…¶ä»–åœ°å€'
    ],
    tooManyResults: [
      'ç¸®å°åœ°ç†ç¯„åœ',
      'é¸æ“‡ç‰¹å®šæ´»å‹•é¡å‹',
      'è¨­å®šæ›´ç²¾ç¢ºçš„æ™‚é–“'
    ]
  }
};
```

### 7.2 ç¯©é¸çµæœé è¦½

```javascript
class FilterPreview {
  // å³æ™‚é¡¯ç¤ºçµæœæ•¸é‡
  showResultCount(filters) {
    const estimatedCount = this.estimateResults(filters);
    const preview = document.querySelector('.result-preview');
    
    preview.textContent = `é è¨ˆæ‰¾åˆ° ${estimatedCount} å€‹æ´»å‹•`;
    
    // å¦‚æœçµæœå¤ªå°‘ï¼Œé¡¯ç¤ºå»ºè­°
    if (estimatedCount < 5) {
      this.showSuggestions('expand');
    } else if (estimatedCount > 50) {
      this.showSuggestions('narrow');
    }
  }
  
  // é¡¯ç¤ºç†±é–€ç¯©é¸çµ„åˆ
  showPopularCombinations() {
    const popular = [
      { name: 'æœ¬é€±æœ«å°åŒ—è—æ–‡æ´»å‹•', filters: { /* ... */ } },
      { name: 'å…è²»è¦ªå­æ´»å‹•', filters: { /* ... */ } },
      { name: 'æµªæ¼«ç´„æœƒæ™¯é»', filters: { /* ... */ } }
    ];
    
    return popular;
  }
}
```

é€™ä»½ç¯©é¸æ©Ÿåˆ¶å„ªåŒ–è¨­è¨ˆæä¾›äº†å®Œæ•´çš„ç¯©é¸åŠŸèƒ½è¦åŠƒï¼Œç¢ºä¿ä½¿ç”¨è€…èƒ½å¤ å¿«é€Ÿæ‰¾åˆ°æ„Ÿèˆˆè¶£çš„è§€å…‰æ´»å‹•ã€‚