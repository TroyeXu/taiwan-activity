# Nuxt.js 觀光活動地圖開發環境設置指南

## 1. 系統需求

### 1.1 基本需求
```yaml
操作系統: macOS / Windows / Linux
Node.js: >= 18.0.0 (推薦 20.x LTS)
npm: >= 8.0.0 或 pnpm >= 7.0.0
Git: >= 2.30.0
```

### 1.2 推薦工具
```yaml
編輯器: VS Code
瀏覽器: Chrome (開發者工具)
終端: iTerm2 (macOS) / Windows Terminal
資料庫管理: Drizzle Studio / DB Browser for SQLite
```

## 2. 開發環境安裝

### 2.1 Node.js 安裝
```bash
# 使用 nvm 管理 Node.js 版本
# macOS/Linux
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 安裝並使用 Node.js 20
nvm install 20
nvm use 20

# Windows 使用 nvm-windows
# 下載並安裝: https://github.com/coreybutler/nvm-windows

# 驗證安裝
node --version  # 應顯示 v20.x.x
npm --version   # 應顯示 10.x.x
```

### 2.2 專案初始化
```bash
# 1. 克隆專案 (如果從 Git 開始)
git clone <repository-url>
cd nuxt-tourism-map

# 2. 或建立新專案
npx nuxi@latest init nuxt-tourism-map
cd nuxt-tourism-map

# 3. 安裝依賴
npm install

# 4. 複製環境變數
cp .env.example .env

# 5. 編輯環境變數
nano .env  # 或使用你喜歡的編輯器
```

### 2.3 必要套件安裝
```bash
# UI 框架和工具
npm install @element-plus/nuxt @nuxtjs/tailwindcss
npm install @pinia/nuxt @vueuse/nuxt

# 資料庫相關
npm install drizzle-orm better-sqlite3
npm install -D drizzle-kit @types/better-sqlite3

# 開發工具
npm install -D @nuxt/devtools eslint prettier
npm install -D @types/node tsx

# 測試工具 (可選)
npm install -D vitest @vue/test-utils @nuxt/test-utils
```

## 3. VS Code 開發環境配置

### 3.1 推薦擴展
```json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin", 
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "ms-vscode.vscode-typescript-next",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json"
  ]
}
```

### 3.2 VS Code 設定
```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "vue.inlayHints.missingProps": true,
  "vue.inlayHints.optionsWrapper": true,
  "tailwindCSS.experimental.classRegex": [
    ["class:\\s*?[\"'`]([^\"'`]*).*?[\"'`]", "[\"'`]([^\"'`]*)[\"'`]"]
  ],
  "files.associations": {
    "*.css": "tailwindcss"
  }
}
```

### 3.3 除錯配置
```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Nuxt: Chrome",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}",
      "sourceMaps": true
    },
    {
      "name": "Nuxt: Server",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/nuxi",
      "args": ["dev"],
      "console": "integratedTerminal"
    }
  ]
}
```

## 4. 資料庫環境設置

### 4.1 SQLite + SpatiaLite 安裝

#### macOS
```bash
# 使用 Homebrew 安裝
brew install sqlite spatialite-tools

# 驗證安裝
sqlite3 --version
spatialite --version
```

#### Ubuntu/Debian
```bash
# 安裝 SQLite 和 SpatiaLite
sudo apt-get update
sudo apt-get install sqlite3 spatialite-bin libspatialite7

# 驗證安裝
sqlite3 --version
spatialite --version
```

#### Windows
```powershell
# 使用 Chocolatey 安裝
choco install sqlite

# 或手動下載
# SQLite: https://sqlite.org/download.html
# SpatiaLite: https://www.gaia-gis.it/fossil/libspatialite/index
```

### 4.2 資料庫初始化腳本
```typescript
// scripts/setup-database.ts
import Database from 'better-sqlite3';
import { migrate } from 'drizzle-orm/better-sqlite3/migrator';
import { drizzle } from 'drizzle-orm/better-sqlite3';
import { existsSync, mkdirSync } from 'fs';
import path from 'path';

async function setupDatabase() {
  // 確保資料目錄存在
  const dataDir = path.join(process.cwd(), 'data');
  if (!existsSync(dataDir)) {
    mkdirSync(dataDir, { recursive: true });
  }

  // 建立資料庫連接
  const dbPath = path.join(dataDir, 'tourism.db');
  const sqlite = new Database(dbPath);
  
  try {
    // 啟用外鍵約束
    sqlite.pragma('foreign_keys = ON');
    
    // 載入 SpatiaLite 擴展
    sqlite.exec('SELECT load_extension("mod_spatialite")');
    console.log('✅ SpatiaLite 擴展載入成功');
    
    // 初始化空間元數據
    sqlite.exec('SELECT InitSpatialMetaData(1)');
    console.log('✅ 空間元數據初始化完成');
    
  } catch (error) {
    console.warn('⚠️  SpatiaLite 擴展載入失敗，將使用基本地理功能');
  }

  // 執行 Drizzle 遷移
  const db = drizzle(sqlite);
  await migrate(db, { migrationsFolder: './db/migrations' });
  console.log('✅ 資料庫遷移完成');

  sqlite.close();
  console.log('🎉 資料庫設置完成！');
}

setupDatabase().catch(console.error);
```

### 4.3 package.json 腳本更新
```json
{
  "scripts": {
    "setup": "tsx scripts/setup-database.ts",
    "dev": "npm run setup && nuxt dev",
    "db:generate": "drizzle-kit generate:sqlite",
    "db:push": "drizzle-kit push:sqlite",
    "db:studio": "drizzle-kit studio",
    "db:seed": "tsx db/seeds/index.ts",
    "db:reset": "rm -f data/tourism.db && npm run setup && npm run db:seed"
  }
}
```

## 5. Google Maps API 設置

### 5.1 API Key 申請
1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 建立新專案或選擇現有專案
3. 啟用以下 API：
   - Maps JavaScript API
   - Geocoding API
   - Places API (可選)
4. 建立 API Key
5. 設定 API Key 限制：
   ```
   應用程式限制: HTTP 參照網址
   允許的網址: 
   - http://localhost:3000/*
   - https://yourdomain.com/*
   ```

### 5.2 API Key 配置
```bash
# .env
GOOGLE_MAPS_KEY=AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxx

# 開發環境可以不限制，生產環境務必設定限制
NUXT_PUBLIC_GOOGLE_MAPS_KEY=AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 5.3 Maps 初始化測試
```vue
<!-- pages/test-map.vue -->
<template>
  <div>
    <h1>Google Maps 測試</h1>
    <div ref="mapRef" style="height: 400px; width: 100%"></div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const mapRef = ref();
const { $config } = useNuxtApp();

onMounted(async () => {
  // 動態載入 Google Maps
  const { Loader } = await import('@googlemaps/js-api-loader');
  
  const loader = new Loader({
    apiKey: $config.public.googleMapsKey,
    version: 'weekly',
  });

  try {
    await loader.load();
    
    // 初始化地圖
    new google.maps.Map(mapRef.value, {
      center: { lat: 25.0330, lng: 121.5654 }, // 台北101
      zoom: 12,
    });
    
    console.log('✅ Google Maps 載入成功');
  } catch (error) {
    console.error('❌ Google Maps 載入失敗:', error);
  }
});
</script>
```

## 6. Claude API 設置 (可選)

### 6.1 API Key 申請
1. 前往 [Anthropic Console](https://console.anthropic.com/)
2. 建立帳號並驗證
3. 建立新的 API Key
4. 設定使用限制和預算

### 6.2 API 測試
```typescript
// server/api/test-claude.get.ts
export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig();
  
  if (!config.claudeApiKey) {
    throw createError({
      statusCode: 500,
      statusMessage: 'Claude API Key not configured'
    });
  }

  try {
    const response = await $fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': config.claudeApiKey,
        'anthropic-version': '2023-06-01'
      },
      body: {
        model: 'claude-3-sonnet-20240229',
        max_tokens: 100,
        messages: [{
          role: 'user',
          content: 'Hello, Claude! This is a test message.'
        }]
      }
    });

    return { success: true, response };
  } catch (error) {
    throw createError({
      statusCode: 500,
      statusMessage: 'Claude API test failed'
    });
  }
});
```

## 7. 開發工具配置

### 7.1 ESLint 配置
```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    browser: true,
    node: true,
  },
  extends: [
    '@nuxtjs/eslint-config-typescript',
    'plugin:prettier/recommended',
  ],
  plugins: [],
  rules: {
    'vue/multi-word-component-names': 'off',
    'vue/no-multiple-template-root': 'off',
  },
};
```

### 7.2 Prettier 配置
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false
}
```

### 7.3 Git Hooks 設置
```bash
# 安裝 husky 和 lint-staged
npm install -D husky lint-staged

# 設置 Git hooks
npx husky install
npx husky add .husky/pre-commit "npx lint-staged"
```

```json
// package.json
{
  "lint-staged": {
    "*.{js,ts,vue}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{css,scss,html,md}": [
      "prettier --write"
    ]
  }
}
```

## 8. 啟動和驗證

### 8.1 完整啟動流程
```bash
# 1. 安裝所有依賴
npm install

# 2. 設置環境變數
cp .env.example .env
# 編輯 .env 文件，填入必要的 API Keys

# 3. 初始化資料庫
npm run db:generate
npm run db:push
npm run db:seed

# 4. 啟動開發服務器
npm run dev

# 5. 開啟瀏覽器
# http://localhost:3000
```

### 8.2 環境驗證清單
```bash
# 執行驗證腳本
npm run check-env
```

```typescript
// scripts/check-env.ts
import { execSync } from 'child_process';
import { existsSync } from 'fs';

console.log('🔍 檢查開發環境...\n');

// 檢查 Node.js 版本
try {
  const nodeVersion = execSync('node --version').toString().trim();
  console.log(`✅ Node.js: ${nodeVersion}`);
} catch {
  console.log('❌ Node.js 未安裝');
}

// 檢查 npm 版本
try {
  const npmVersion = execSync('npm --version').toString().trim();
  console.log(`✅ npm: ${npmVersion}`);
} catch {
  console.log('❌ npm 未安裝');
}

// 檢查資料庫文件
if (existsSync('./data/tourism.db')) {
  console.log('✅ 資料庫文件存在');
} else {
  console.log('⚠️  資料庫文件不存在，請執行 npm run setup');
}

// 檢查環境變數
if (existsSync('.env')) {
  console.log('✅ 環境變數文件存在');
} else {
  console.log('⚠️  .env 文件不存在，請複製 .env.example');
}

console.log('\n🎉 環境檢查完成！');
```

## 9. 常見問題解決

### 9.1 SpatiaLite 擴展問題
```bash
# 如果 SpatiaLite 載入失敗
# macOS: 重新安裝 spatialite-tools
brew reinstall spatialite-tools

# Ubuntu: 檢查擴展路徑
sudo find /usr -name "*spatialite*" -type f 2>/dev/null

# 手動指定擴展路徑
sqlite3 -cmd "SELECT load_extension('/usr/lib/x86_64-linux-gnu/mod_spatialite.so')" tourism.db
```

### 9.2 Google Maps 載入問題
```typescript
// 添加錯誤處理
const loadGoogleMaps = async () => {
  try {
    const { Loader } = await import('@googlemaps/js-api-loader');
    const loader = new Loader({
      apiKey: config.public.googleMapsKey,
      version: 'weekly',
      libraries: ['places'] // 如果需要
    });
    
    await loader.load();
    return true;
  } catch (error) {
    console.error('Google Maps 載入失敗:', error);
    // 顯示錯誤訊息給用戶
    return false;
  }
};
```

### 9.3 依賴衝突解決
```bash
# 清除 node_modules 和 lock 文件
rm -rf node_modules package-lock.json

# 重新安裝
npm install

# 或使用 npm ci (推薦在 CI/CD)
npm ci
```

這個開發環境設置指南確保了團隊成員能夠快速建立一致的開發環境，減少環境配置相關的問題。