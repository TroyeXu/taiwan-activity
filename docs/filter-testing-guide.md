# 篩選功能測試指南

## 測試環境準備

### 1. 確認資料庫連接
```bash
# 開啟開發伺服器
npm run dev

# 確認瀏覽器控制台出現以下訊息
✅ 資料庫初始化成功
```

### 2. 檢查資料完整性
在瀏覽器控制台執行：
```javascript
// 檢查資料庫是否有資料
const { query } = useSqlite();
const count = await query('SELECT COUNT(*) as total FROM activities');
console.log('活動總數:', count[0].total);
```

## 測試案例

### 1. 城市篩選測試

**測試步驟：**
1. 點擊「位置與距離」展開篩選面板
2. 在「地區篩選」下拉選單中選擇城市
3. 觀察結果

**測試案例：**
```javascript
// 測試案例 1: 選擇台北市
選擇城市: "台北市"
預期結果: 只顯示位於台北市的活動

// 測試案例 2: 選擇高雄市
選擇城市: "高雄市"
預期結果: 只顯示位於高雄市的活動

// 測試案例 3: 清除城市篩選
清除選擇
預期結果: 顯示所有城市的活動
```

**驗證 SQL：**
```sql
-- 檢查台北市活動數量
SELECT COUNT(*) FROM activities a 
LEFT JOIN locations l ON l.activity_id = a.id 
WHERE l.city = '台北市';
```

### 2. 活動類型篩選測試

**測試步驟：**
1. 點擊「活動類型」展開篩選面板
2. 勾選不同類型的活動
3. 觀察結果

**測試案例：**
```javascript
// 測試案例 1: 單一類型
勾選: "音樂表演"
預期結果: 只顯示音樂類活動

// 測試案例 2: 多重類型
勾選: ["音樂表演", "展覽活動"]
預期結果: 顯示音樂或展覽類活動

// 測試案例 3: 取消所有類型
取消所有勾選
預期結果: 顯示所有類型活動
```

**驗證 SQL：**
```sql
-- 檢查音樂類活動
SELECT COUNT(*) FROM activities a
LEFT JOIN activity_categories ac ON ac.activity_id = a.id
LEFT JOIN categories c ON c.id = ac.category_id
WHERE c.slug = 'music';
```

### 3. 日期篩選測試

**測試步驟：**
1. 點擊「活動時間」展開篩選面板
2. 選擇不同的快速選項或自訂日期

**測試案例：**
```javascript
// 測試案例 1: 今天
點擊: "今天"
預期結果: 只顯示今天的活動

// 測試案例 2: 本週末
點擊: "本週末"
預期結果: 顯示本週六日的活動

// 測試案例 3: 自訂日期範圍
選擇: 2024-01-01 至 2024-01-31
預期結果: 顯示1月份的活動
```

**驗證 SQL：**
```sql
-- 檢查今天的活動
SELECT COUNT(*) FROM activities a
LEFT JOIN activity_times at ON at.activity_id = a.id
WHERE at.start_date = date('now');
```

### 4. 價格篩選測試

**測試步驟：**
1. 點擊「費用」展開篩選面板
2. 選擇不同的價格選項

**測試案例：**
```javascript
// 測試案例 1: 免費活動
選擇: "免費"
預期結果: 只顯示免費活動

// 測試案例 2: 收費活動
選擇: "收費"
預期結果: 只顯示需付費的活動

// 測試案例 3: 不限
選擇: "不限"
預期結果: 顯示所有活動
```

### 5. 標籤篩選測試

**測試步驟：**
1. 點擊「熱門標籤」展開篩選面板
2. 點擊不同的標籤

**測試案例：**
```javascript
// 測試案例 1: 單一標籤
點擊: "室內活動"
預期結果: 只顯示室內活動

// 測試案例 2: 多個標籤
點擊: ["室內活動", "親子活動"]
預期結果: 顯示包含任一標籤的活動
```

### 6. 組合篩選測試

**測試案例：**
```javascript
// 測試案例 1: 城市 + 類型
選擇城市: "台北市"
選擇類型: "音樂表演"
預期結果: 只顯示台北市的音樂表演活動

// 測試案例 2: 日期 + 價格
選擇日期: "本週末"
選擇價格: "免費"
預期結果: 只顯示本週末的免費活動

// 測試案例 3: 完整組合
選擇城市: "台中市"
選擇類型: "展覽活動"
選擇日期: "本月"
選擇價格: "免費"
選擇標籤: "親子活動"
預期結果: 符合所有條件的活動
```

### 7. 位置距離篩選測試

**測試步驟：**
1. 點擊「取得目前位置」按鈕
2. 開啟「附近活動篩選」
3. 調整距離滑桿

**測試案例：**
```javascript
// 測試案例 1: 5公里內
設定距離: 5km
預期結果: 只顯示5公里內的活動

// 測試案例 2: 擴大範圍
設定距離: 30km
預期結果: 顯示30公里內的活動
```

## 效能測試

### 1. 載入速度測試
```javascript
// 測量篩選回應時間
console.time('篩選執行時間');
await searchActivities({ 
  filters: { cities: ['台北市'] } 
});
console.timeEnd('篩選執行時間');
// 預期: < 500ms
```

### 2. 大量資料測試
```javascript
// 測試多重篩選條件
const filters = {
  cities: ['台北市', '新北市'],
  categories: ['music', 'exhibition'],
  tags: ['indoor', 'family'],
  priceRange: { min: 0, max: 1000 }
};
// 預期: 正常顯示結果，無錯誤
```

## 錯誤處理測試

### 1. 無結果測試
```javascript
// 選擇不存在的組合
選擇城市: "澎湖縣"
選擇類型: "音樂表演"
選擇日期: "今天"
預期結果: 顯示「沒有找到符合條件的活動」
```

### 2. 網路錯誤測試
```javascript
// 模擬網路中斷
1. 開啟開發者工具
2. Network 標籤 -> Offline 模式
3. 執行篩選
預期結果: 顯示錯誤提示訊息
```

## 回歸測試檢查清單

- [ ] 城市篩選正常運作
- [ ] 活動類型篩選正常運作
- [ ] 日期篩選（快速選項）正常運作
- [ ] 日期篩選（自訂日期）正常運作
- [ ] 價格篩選正常運作
- [ ] 標籤篩選正常運作
- [ ] 位置定位功能正常運作
- [ ] 距離篩選正常運作
- [ ] 組合篩選正常運作
- [ ] 清除篩選功能正常運作
- [ ] 搜尋關鍵字功能正常運作
- [ ] 無結果時顯示正確訊息
- [ ] 載入狀態顯示正確
- [ ] 結果數量顯示正確
- [ ] 手機版篩選面板正常運作

## 開發者除錯工具

### 1. 檢查當前篩選條件
```javascript
// 在控制台執行
const { filters } = useFilters();
console.log('當前篩選條件:', filters.value);
```

### 2. 檢查 SQL 查詢
```javascript
// 開啟 SQL 查詢日誌
localStorage.setItem('DEBUG_SQL', 'true');
// 重新整理頁面查看控制台
```

### 3. 檢查資料格式
```javascript
// 檢查活動資料格式
const { activities } = useActivitiesClient();
console.log('第一筆活動資料:', activities.value[0]);
```

## 常見問題排查

### 問題 1: 城市篩選無效
**檢查步驟：**
1. 確認資料庫中城市欄位是否為中文
2. 確認篩選傳遞的是中文城市名稱
3. 檢查 SQL 查詢是否正確

### 問題 2: 標籤篩選無效
**檢查步驟：**
1. 確認標籤使用 slug 而非中文名稱
2. 確認標籤關聯表資料正確
3. 檢查 tags 參數是否正確傳遞

### 問題 3: 日期篩選無效
**檢查步驟：**
1. 確認日期格式為 YYYY-MM-DD
2. 確認時區處理正確
3. 檢查日期範圍邏輯

## 測試資料準備

```sql
-- 插入測試資料（如需要）
INSERT INTO activities (id, name, description) VALUES 
('test-1', '測試音樂會', '台北測試活動'),
('test-2', '測試展覽', '高雄測試活動');

INSERT INTO locations (activity_id, city, address) VALUES
('test-1', '台北市', '台北市信義區測試路1號'),
('test-2', '高雄市', '高雄市前鎮區測試路2號');

INSERT INTO categories (id, name, slug) VALUES
('cat-test-1', '音樂表演', 'music'),
('cat-test-2', '展覽活動', 'exhibition');

INSERT INTO activity_categories (activity_id, category_id) VALUES
('test-1', 'cat-test-1'),
('test-2', 'cat-test-2');
```

## 測試報告模板

```markdown
測試日期: YYYY-MM-DD
測試人員: 
測試環境: Development / Production

### 測試結果摘要
- 通過測試案例: X/Y
- 發現問題數: Z

### 詳細測試結果
| 測試項目 | 預期結果 | 實際結果 | 狀態 | 備註 |
|---------|---------|---------|------|------|
| 城市篩選 | 正確篩選 | 正確篩選 | ✅ | - |
| 類型篩選 | 正確篩選 | 正確篩選 | ✅ | - |
| ... | ... | ... | ... | ... |

### 發現的問題
1. 問題描述
2. 重現步驟
3. 預期行為
4. 實際行為

### 建議改進
1. ...
2. ...
```